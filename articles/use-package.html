<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using shinytest2 with R packages â€¢ shinytest2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="â€image/svg+xmlâ€" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using shinytest2 with R packages">
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">shinytest2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.1.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/shinytest2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/in-depth.html">Testing in depth</a></li>
    <li><a class="dropdown-item" href="../articles/robust.html">Robust testing</a></li>
    <li><a class="dropdown-item" href="../articles/use-application-audit.html">Auditing Shiny apps</a></li>
    <li><a class="dropdown-item" href="../articles/use-ci.html">Using shinytest2 with continuous integration</a></li>
    <li><a class="dropdown-item" href="../articles/use-package.html">Using shinytest2 with R packages</a></li>
    <li><a class="dropdown-item" href="../articles/using-monkey-testing.html">Monkey testing</a></li>
    <li><a class="dropdown-item" href="../articles/z-migration.html">Migrating from shinytest</a></li>
    <li><a class="dropdown-item" href="../articles/zzz-faq.html">Frequently Asked Questions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rstudio/shinytest2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Using shinytest2 with R packages</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rstudio/shinytest2/blob/rc-v0.5.0/vignettes/use-package.Rmd" class="external-link"><code>vignettes/use-package.Rmd</code></a></small>
      <div class="d-none name"><code>use-package.Rmd</code></div>
    </div>

    
    
<p>For R packages that have Shiny applications, there are generally two
ways that the applications will be present in the package. The first is
to have an <code>app.R</code> in a subdirectory of <code>inst/</code>.
The second way is to have a function which returns a Shiny app
object.</p>
<!-- See https://github.com/rstudio/shinytestPackageExample for an example package. This document closely mirrors the content of that package: it explains how to set up tests for both types of applications, and then has a section that describes some setup tasks that are common to both types. -->
<blockquote>
<p>ðŸš§ Using <a href="https://rstudio.github.io/chromote/" class="external-link">chromote</a> in CRAN tests</p>
<p><a href="https://rstudio.github.io/chromote/" class="external-link">chromote</a> utilizes the Google Chrome application
installed on testing machines, which can change over time. CRAN has
requested that no package utilize <a href="https://rstudio.github.io/chromote/" class="external-link">chromote</a>â€™s
functionality when testing on CRAN. This is because the package may not
work as expected if the version of Google Chrome changes.</p>
<p>To address this, <a href="https://rstudio.github.io/shinytest2/">shinytest2</a> will call
<code><a href="https://testthat.r-lib.org/reference/skip.html" class="external-link">testthat::skip_on_cran()</a></code> when creating an
<code>AppDriver</code> during CRAN testing.</p>
<p>To learn more about CRANâ€™s reasoning and how to test your package
using CI, please visit <a href="https://rstudio.github.io/chromote/" class="external-link">chromote</a>â€™s <a href="https://rstudio.github.io/chromote/articles/example-cran-tests.html" class="external-link">Using
<code>{chromote}</code> in CRAN tests</a>.</p>
</blockquote>
<div class="section level2">
<h2 id="applications-defined-in-another-file">Applications defined in another file<a class="anchor" aria-label="anchor" href="#applications-defined-in-another-file"></a>
</h2>
<p>Placing your Shiny application in a subdirectory of
<code>inst/</code> is a common and clean way to include Shiny
applications in R packages.</p>
<pre><code>/
â”œâ”€â”€ DESCRIPTION
â”œâ”€â”€ NAMESPACE
â”œâ”€â”€ R
â”œâ”€â”€ inst
â”‚   â””â”€â”€ sample_app
â”‚       â”œâ”€â”€ app.R
â””â”€â”€ tests
    â”œâ”€â”€ testthat
    â”‚   â”œâ”€â”€ _snaps
    â”‚   â”‚   â””â”€â”€ sample_app
    â”‚   â”‚       â””â”€â”€ 001.json
    â”‚   â””â”€â”€ test-sample_app.R
    â””â”€â”€ testthat.R</code></pre>
<p>When recording tests for this application, <code><a href="../reference/record_test.html">record_test()</a></code>
will save the test files in the packageâ€™s <code>tests/testthat/</code>
directory. This doesnâ€™t clutter the application directory with test
files and leverages existing package testing infrastructure for a
unified testing experience.</p>
<p>Within each test file, supply the application directory to
<code>AppDriver$new()</code>. For example, in
<code>tests/testthat/test-sample_app.R</code>, you would have:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># File: tests/testthat/test-sample_app.R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/shinytest2/">shinytest2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span><span class="st">"sample_app works"</span>, <span class="op">{</span></span>
<span>  <span class="co"># Don't run these tests on the CRAN build servers</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/skip.html" class="external-link">skip_on_cran</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">appdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"exPackage"</span>, <span class="st">"sample_app"</span><span class="op">)</span></span>
<span>  <span class="va">app</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/AppDriver.html">AppDriver</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">appdir</span>, name <span class="op">=</span> <span class="st">"sample_app"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">app</span><span class="op">$</span><span class="fu">expect_values</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>If the application directory is not meant to be public, it can also
be located in <code>./tests/testthat/apps</code>.
<a href="https://rstudio.github.io/shinytest2/">shinytest2</a> does this with many application and has
<code>appdir</code> above point to the relative path to the application.
<code>app_dir &lt;- testthat::test_path("apps/sample_app")</code>.</p>
</div>
<div class="section level2">
<h2 id="applications-using-a-function">Applications using a function<a class="anchor" aria-label="anchor" href="#applications-using-a-function"></a>
</h2>
<p>Some packages, such as <a href="https://thinkr-open.github.io/golem/" class="external-link">golem</a>, provide a function that
runs or returns a shiny application. In this case, you can create a
wrapper function to perform two actions: load the package via
<code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> or <code><a href="https://rdrr.io/r/base/library.html" class="external-link">require()</a></code> and returns/runs an
app. For example, if your package is named <code>mypkg</code>, your
package structure may look like:</p>
<pre><code>/
â”œâ”€â”€ .Rbuildignore
â”œâ”€â”€ DESCRIPTION
â”œâ”€â”€ NAMESPACE
â”œâ”€â”€ R
â”‚   â””â”€â”€ run-app.R
â””â”€â”€ tests
    â”œâ”€â”€ testthat
    â”‚   â”œâ”€â”€ _snaps
    â”‚   â”‚   â””â”€â”€ app-function
    â”‚   â”‚       â””â”€â”€ 001.json
    â”‚   â””â”€â”€ test-app-function.R
    â””â”€â”€ testthat.R</code></pre>
<p>and the function that runs the app is <code>run_app()</code>, you can
pass in functions defined within your R package directly to
<code>AppDriver$new()</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># File: tests/testthat/test-app-function.R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/shinytest2/">shinytest2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span><span class="st">"mypkg app initial values are consistent"</span>, <span class="op">{</span></span>
<span>  <span class="co"># Don't run these tests on the CRAN build servers</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/skip.html" class="external-link">skip_on_cran</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">app</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/AppDriver.html">AppDriver</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">run_app</span>, name <span class="op">=</span> <span class="st">"mypkg-app"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">app</span><span class="op">$</span><span class="fu">expect_values</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>This works as <a href="https://rstudio.github.io/shinytest2/">shinytest2</a> recognizes that the
<code>run_app</code> function is part of the local package. When running
a local package methods, <a href="https://rstudio.github.io/shinytest2/">shinytest2</a> will call the method
within the scope of your local R package in the the background
process.</p>
<p>The specially handled function is functionally equivalent to defining
a wrapper function that loads the package and calls
<code>run_app()</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># File: tests/testthat/test-app-function.R</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/shinytest2/">shinytest2</a></span><span class="op">)</span></span>
<span><span class="va">run_mypkg_app</span> <span class="op">&lt;-</span></span>
<span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span><span class="st">"mypkg app initial values are consistent"</span>, <span class="op">{</span></span>
<span>  <span class="co"># Don't run these tests on the CRAN build servers</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/skip.html" class="external-link">skip_on_cran</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">app</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/AppDriver.html">AppDriver</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"mypkg-app"</span>, <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mypkg</span><span class="op">)</span></span>
<span>    <span class="fu">run_app</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">app</span><span class="op">$</span><span class="fu">expect_values</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>When using a function to initialize the <code>AppDriver</code>,
<a href="https://rstudio.github.io/shinytest2/">shinytest2</a> will automatically call
<code><a href="https://pkgload.r-lib.org/reference/load_all.html" class="external-link">pkgload::load_all()</a></code> when you execute
<code>library(&lt;pkg&gt;)</code> or <code>require(&lt;pkg&gt;)</code>
to load your dev package, <code>&lt;pkg&gt;</code>, in the background R
process. Currently, only the local dev package can be loaded. Similar to
<a href="https://mirai.r-lib.org" class="external-link">mirai</a>, there is also no carryover from the testing
environment to the supplied function execution within the background R
process. All packages may need to be <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code>â€™ed
again!</p>
</div>
<div class="section level2">
<h2 id="application-objects">Application objects<a class="anchor" aria-label="anchor" href="#application-objects"></a>
</h2>
<p>The third way have an application in an R package is by having a
function that returns a Shiny application object. App objects being
supplied directly to <code>AppDriver$new()</code> are to be considered
for quick testing / confirmation of targeted behavior. For more complex
applications, it is recommended to use one of the other two approaches
described above as not all global variables and contexts are preserved
when serializing the app object.</p>
<p>In this example, thereâ€™s a function <code>hello_world_app()</code>,
which lives in <code>R/app-object.R</code>:</p>
<pre><code>/
â”œâ”€â”€ .Rbuildignore
â”œâ”€â”€ DESCRIPTION
â”œâ”€â”€ NAMESPACE
â”œâ”€â”€ R
â”‚   â””â”€â”€ app-object.R
â””â”€â”€ tests
    â”œâ”€â”€ testthat
    â”‚   â”œâ”€â”€ _snaps
    â”‚   â”‚   â””â”€â”€ app-object
    â”‚   â”‚       â””â”€â”€ 001.json
    â”‚   â””â”€â”€ test-app-object.R
    â””â”€â”€ testthat.R</code></pre>
<p>The function simply returns an object from
<code><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># File: R/app-object.R</span></span>
<span></span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/cars.html" class="external-link">cars</a></span></span>
<span></span>
<span><span class="va">hello_world_app</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span></span>
<span>    ui <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"n"</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html" class="external-link">plotOutput</a></span><span class="op">(</span><span class="st">"plot"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    server <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">output</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html" class="external-link">renderPlot</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dt</span>, <span class="va">input</span><span class="op">$</span><span class="va">n</span><span class="op">)</span>,</span>
<span>          xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">dt</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>          ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">dt</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Once we have the object, it can be supplied directly to
<code>AppDriver$new()</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># File: tests/testthat/test-app-function.R</span></span>
<span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span><span class="st">"hello-world app initial values are consistent"</span>, <span class="op">{</span></span>
<span>  <span class="co"># Don't run these tests on the CRAN build servers</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/skip.html" class="external-link">skip_on_cran</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">shiny_app</span> <span class="op">&lt;-</span> <span class="fu">hello_world_app</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">app</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/AppDriver.html">AppDriver</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">shiny_app</span>, name <span class="op">=</span> <span class="st">"hello"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">app</span><span class="op">$</span><span class="fu">expect_values</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>To help create tests, you can call <code><a href="../reference/record_test.html">record_test()</a></code> on your
shiny application object directly. Unfortunately, the test file will not
be able to be saved. Instead, the test commands can be copied into a
test script manually.</p>
</div>
<div class="section level2">
<h2 id="other-setup-steps">Other setup steps<a class="anchor" aria-label="anchor" href="#other-setup-steps"></a>
</h2>
<p>There are a few steps that are needed for both types of tests.</p>
<p>It is recommended to call <code><a href="../reference/use_shinytest2.html">shinytest2::use_shinytest2()</a></code>
to enable different test config set-ups.</p>
<p>You will need to add <a href="https://rstudio.github.io/shinytest2/">shinytest2</a> to the
<code>Suggests</code> section in your <code>DESCRIPTION</code> file.</p>
<pre><code><span><span class="va">Suggests</span><span class="op">:</span></span>
<span>    <span class="va">shinytest2</span></span></code></pre>
<p>When all of these items are in place, you can test your package using
<code><a href="https://testthat.r-lib.org/reference/test_package.html" class="external-link">testthat::test_local()</a></code> or by running
<code>R CMD check</code> on your package. If you are using the RStudio
IDE, you can also run Build -&gt; Test Package or Build -&gt; Check
Package.</p>
<p><a href="https://rstudio.github.io/shinytest2/">shinytest2</a> <strong>no longer</strong> requires that
your package to be <em>installed</em> when testing. It will load from
your local path. <a href="https://testthat.r-lib.org/reference/test_package.html" class="external-link"><code>testthat::test_local()</code></a>
(and related wrappers) eventually call <code><a href="https://pkgload.r-lib.org/reference/load_all.html" class="external-link">pkgload::load_all()</a></code>
to temporarily source the local R package in the foreground for unit
testing. <a href="https://rstudio.github.io/shinytest2/">shinytest2</a> has made the stance that App authors
<strong>must</strong> call <code>library(&lt;pkg&gt;)</code> or
<code>require(&lt;pkg&gt;)</code> on their package within their App.
This ensures that the package is loaded in the background R process that
runs the Shiny application. When <code>library*()</code> is called,
<a href="https://rstudio.github.io/shinytest2/">shinytest2</a> will automatically execute
<code><a href="https://pkgload.r-lib.org/reference/load_all.html" class="external-link">pkgload::load_all()</a></code> to load the packageâ€™s source code.</p>
</div>
<div class="section level2">
<h2 id="how-should-i-test-multiple-applications">How should I test multiple applications?<a class="anchor" aria-label="anchor" href="#how-should-i-test-multiple-applications"></a>
</h2>
<p>Given you have multiple applications / app functions in your package,
you can create multiple test files in <code>tests/testthat/</code>, one
for each application. Each test file can create its own
<code>AppDriver</code> instance for the specific application being
tested.</p>
<p>It is not recommended to utilize <code>test_app("path/to/app")</code>
within package testing as we want the tests to be controlled by the
packageâ€™s <code>testthat</code> infrastructure. This allows for more
flexibility and control over how your applications are tested while your
current packageâ€™s testthat infrastructure.</p>
<p>Good: * Supply a function from within your package to
<code>AppDriver$new()</code> and test within your packageâ€™s
<code><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">testthat::test_that()</a></code> tests. * Supply an application
directory within your package to <code>AppDriver$new()</code> and test
within your packageâ€™s <code><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">testthat::test_that()</a></code> tests. Bad: *
Call <code>test_app("path/to/app")</code> within your packageâ€™s
<code><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">testthat::test_that()</a></code> tests.</p>
<p>This keeps your snaps all in one place and not scattered across
multiple application directories.</p>
</div>
<div class="section level2">
<h2 id="migrating-from-shinytest-v0-4-0-to-v0-5-0">Migrating from shinytest v0.4.0 to v0.5.0<a class="anchor" aria-label="anchor" href="#migrating-from-shinytest-v0-4-0-to-v0-5-0"></a>
</h2>
<p>Previously, it was encouraged to store tests within the application
directory itself. This made sense when applications were primarily
standalone. However, for R packages, it is more idiomatic to store tests
in the <code>tests/testthat/</code> directory and utilize an app that is
defined elsewhere (either in <code>inst/</code> or another
directory).</p>
<p>Previous file structure:</p>
<pre><code>/
â”œâ”€â”€ DESCRIPTION
â”œâ”€â”€ NAMESPACE
â”œâ”€â”€ R
â”œâ”€â”€ inst
â”‚   â””â”€â”€ sample_app
â”‚       â”œâ”€â”€ app.R
â”‚       â”œâ”€â”€ R
â”‚       â”‚   â””â”€â”€ helpers.R
â”‚       â””â”€â”€ tests
â”‚           â”œâ”€â”€ testthat.R
â”‚           â””â”€â”€ testthat
â”‚              â”œâ”€â”€ setup-shinytest2.R
â”‚              â””â”€â”€ test-sample_app.R
â””â”€â”€ tests
    â”œâ”€â”€ testthat.R
    â””â”€â”€ testthat
        â””â”€â”€ test-other-things.R</code></pre>
<p>Previous <code>test-sample_app.R</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/shinytest2/">shinytest2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span><span class="st">"sample_app works"</span>, <span class="op">{</span></span>
<span>  <span class="va">app</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/AppDriver.html">AppDriver</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"sample_app"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">app</span><span class="op">$</span><span class="fu">expect_values</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html" class="external-link">expect_equal</a></span><span class="op">(</span><span class="va">app</span><span class="op">$</span><span class="fu">get_value</span><span class="op">(</span><span class="st">"input$n"</span><span class="op">)</span>, <span class="va">helper_value</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>It is now recommended to store all tests in
<code>tests/testthat/</code> and have the application defined elsewhere.
This keeps the application directory clean and leverages existing
package testing infrastructure for a unified testing experience.</p>
<p>New file structure:</p>
<pre><code>/
â”œâ”€â”€ DESCRIPTION
â”œâ”€â”€ NAMESPACE
â”œâ”€â”€ R
â”œâ”€â”€ inst
â”‚   â””â”€â”€ sample_app
â”‚       â”œâ”€â”€ app.R
â”‚       â”œâ”€â”€ R
â”‚           â””â”€â”€ helpers.R
â””â”€â”€ tests
    â”œâ”€â”€ testthat.R
    â””â”€â”€ testthat
        â”œâ”€â”€ test-other-things.R
        â””â”€â”€ test-sample_app.R</code></pre>
<p>New <code>test-sample_app.R</code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/shinytest2/">shinytest2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span><span class="st">"sample_app works"</span>, <span class="op">{</span></span>
<span>  <span class="va">appdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"exPackage"</span>, <span class="st">"sample_app"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/app_support.html">local_app_support</a></span><span class="op">(</span><span class="va">appdir</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">app</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/AppDriver.html">AppDriver</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">appdir</span>, name <span class="op">=</span> <span class="st">"sample_app"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">app</span><span class="op">$</span><span class="fu">expect_values</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html" class="external-link">expect_equal</a></span><span class="op">(</span><span class="va">app</span><span class="op">$</span><span class="fu">get_value</span><span class="op">(</span><span class="st">"input$n"</span><span class="op">)</span>, <span class="va">helper_value</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Since we have moved the tests out of the application directory, we
need to ensure that any supporting files (like snapshots) are still
accessible. When testing <strong>only</strong> an application, the
premise is similar to a package where all supporting files should be
available in the testing environment. However, within a package, the
application is a means to test the package and should not automatically
load supporting files into the entire testing environment, possibly
causing conflicts with other Shiny applications or tests.</p>
<p>To address this, we use <code>local_app_support(appdir)</code> to
temporarily link the necessary support files from the application
directory to the test environment. This ensures that the tests can
access the required snapshots and other supporting files without
cluttering the application directory itself.</p>
</div>
<div class="section level2">
<h2 id="continuous-integration">Continuous integration<a class="anchor" aria-label="anchor" href="#continuous-integration"></a>
</h2>
<p>If you would like your package to be tested with every commit, you
can set it up with GitHub Actions. Please see <a href="./use-ci.html">Using shinytest2 with continuous integration</a>
for inspiration.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="http://schloerke.com" class="external-link">Barret Schloerke</a>, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

  </div></footer>
</body>
</html>
