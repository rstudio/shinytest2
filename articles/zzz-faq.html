<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Frequently Asked Questions • shinytest2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Frequently Asked Questions">
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">shinytest2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.1.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/shinytest2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/in-depth.html">Testing in depth</a></li>
    <li><a class="dropdown-item" href="../articles/robust.html">Robust testing</a></li>
    <li><a class="dropdown-item" href="../articles/use-application-audit.html">Auditing Shiny apps</a></li>
    <li><a class="dropdown-item" href="../articles/use-ci.html">Using shinytest2 with continuous integration</a></li>
    <li><a class="dropdown-item" href="../articles/use-package.html">Using shinytest2 with R packages</a></li>
    <li><a class="dropdown-item" href="../articles/using-monkey-testing.html">Monkey testing</a></li>
    <li><a class="dropdown-item" href="../articles/z-migration.html">Migrating from shinytest</a></li>
    <li><a class="dropdown-item" href="../articles/zzz-faq.html">Frequently Asked Questions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rstudio/shinytest2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Frequently Asked Questions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rstudio/shinytest2/blob/rc-v0.5.0/vignettes/zzz-faq.Rmd" class="external-link"><code>vignettes/zzz-faq.Rmd</code></a></small>
      <div class="d-none name"><code>zzz-faq.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="what-does-it-mean-when-i-run-test_app-and-it-says-server-did-not-update-any-output-values-within-3-seconds">What does it mean when I run <code>test_app()</code> and it says,
“Server did not update any output values within 3 seconds”?<a class="anchor" aria-label="anchor" href="#what-does-it-mean-when-i-run-test_app-and-it-says-server-did-not-update-any-output-values-within-3-seconds"></a>
</h2>
<p>The full message is this:</p>
<pre><code>Server did not update any output values within 3 seconds. If this is expected, use `wait_ = FALSE` or increase the value of `timeout_`.</code></pre>
<p>This happens when setting an <code>input</code> value does
<em>not</em> result in an output changing.</p>
<p><a href="https://rstudio.github.io/shinytest2/">shinytest2</a> normally assumes that when you call
<code>app$set_inputs()</code>, the setting of an input will also result
in a changed output, so the test driver process will wait for an output
to change before moving on to the next step in a test script. If no
outputs change within the timeout period (which defaults to 3 seconds),
it prints that message.</p>
<p>If, in your application, you expect that setting a particular input
does not immediately result in any output changes, then you should call
<code>app$set_inputs()</code> with <code>wait_=FALSE</code>.</p>
<p>On the other hand, if you expect that setting the input should result
in an output change, but the time exceeds the timeout, then you can call
<code>app$set_inputs()</code> with, for example,
<code>timeout_ = 10 * 1000</code>.</p>
</div>
<div class="section level2">
<h2 id="some-input-values-are-not-set-right-after-calling-appset_inputs--how-do-i-wait-for-them">Some input values are not set right after calling
<code>app$set_inputs()</code>. How do I wait for them?<a class="anchor" aria-label="anchor" href="#some-input-values-are-not-set-right-after-calling-appset_inputs--how-do-i-wait-for-them"></a>
</h2>
<p>In most situations, when an <code>input</code> value is set,
<a href="https://rstudio.github.io/shinytest2/">shinytest2</a> will wait for the next value to be sent to the
server. (See question above and <a href="in-depth.html#wait-for-value">this section in Testing in
depth</a>. However, when dealing with dynamic UI inputs, htmlwidgets, or
even selectize inputs, <code>input</code> values are not set on the
first <code>output</code> change. Use
<code>app$wait_for_value(input = NAME, ignore = list(VALUE_1, ...., VALUE_N))</code>
to wait until a particular <code>input</code> (or <code>output</code>)
value is available (or has a non-invalid value).</p>
</div>
<div class="section level2">
<h2 id="how-can-my-app-detect-if-its-running-in-shinytest2">How can my app detect if it’s running in
<code>{shinytest2}</code>?<a class="anchor" aria-label="anchor" href="#how-can-my-app-detect-if-its-running-in-shinytest2"></a>
</h2>
<p>Sometimes it can be useful to alter the behavior of your application
when it’s being tested. To detect when it’s being tested, you can use
<code>isTRUE(getOption("shiny.testmode"))</code>, as in:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"shiny.testmode"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="co"># Do something special here</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="how-can-i-get-the-objects-from-files-in-my-the-r-folder-into-the-testing-environment">How can I get the objects from files in my the R folder into the
testing environment?<a class="anchor" aria-label="anchor" href="#how-can-i-get-the-objects-from-files-in-my-the-r-folder-into-the-testing-environment"></a>
</h2>
<p>Loading the support environment for a Shiny application requires a
call to <code><a href="../reference/app_support.html">shinytest2::local_app_support()</a></code> or
<code><a href="../reference/app_support.html">shinytest2::with_app_support()</a></code>. Add these calls to your
unit tests to load the support into the appropriate environments. These
methods will load the <code>global.R</code> and all R files into the
testing environment, similar to testing package R code.</p>
<p>This is not automatically performed as it may be costly to load the
support environment.</p>
</div>
<div class="section level2">
<h2 id="can-i-modify-the-input-and-output-values-that-are-recorded-in-snapshots">Can I modify the <code>input</code> and <code>output</code> values
that are recorded in snapshots?<a class="anchor" aria-label="anchor" href="#can-i-modify-the-input-and-output-values-that-are-recorded-in-snapshots"></a>
</h2>
<p>For some kinds of outputs, it is problematic to record the raw value
directly in a JSON snapshot. The output might be very large (e.g., image
data or a large table), or it may contain randomly-generated values for
which the specific value is unimportant for testing (such as
randomly-generated DOM element IDs).</p>
<p>In these situations, you can use an <em>output preprocessor</em>
function. This is most commonly done by the author of component used in
an application, although it can also be done by an application author.
An output preprocessor function is passed an object representing the
output value, and it should return a value. If the problem is that the
value is large, the preprocessor function can modify the value by
hashing it and returning the hash. If the problem is that the value
contains some random values, the preprocessor function can replace the
random values with fixed ones.</p>
<p>To add an output preprocessor, use
<code><a href="https://rdrr.io/pkg/shiny/man/snapshotPreprocessOutput.html" class="external-link">shiny::snapshotPreprocessOutput()</a></code> to modify an output
renderer. For example, see <a href="https://github.com/rstudio/shiny/blob/81cc7c5/R/shinywrappers.R#L656-L663" class="external-link">this
section</a> of the <code><a href="https://rdrr.io/pkg/shiny/man/renderDataTable.html" class="external-link">renderDataTable()</a></code> function. It takes the
object that <em>would be</em> returned by
<code><a href="https://rdrr.io/pkg/shiny/man/renderDataTable.html" class="external-link">renderDataTable()</a></code>, and modifies it by adding an output
preprocessor which removes strings that contain random values.</p>
<p>For some outputs (notably htmlwidgets), the output value is text
string containing JSON, and if you want to modify the JSON, you will
have to either (1) do text processing on the JSON, or (2) convert the
JSON to an R object, modify the R object, and convert the R object back
to JSON. The plotly R package uses this method in <a href="https://github.com/plotly/plotly.R/blob/2eef4ab/R/shiny.R#L46-L53" class="external-link"><code>renderPlotly()</code></a>.</p>
<p>The examples above modify the output renderer from inside the output
renderer function, and this would have to be done by the author of the
component. It is also possible for an application author to modify a
renderer with something like the following:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span></span>
<span>  ui <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html" class="external-link">verbatimTextOutput</a></span><span class="op">(</span><span class="st">"random"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  server <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">random</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/snapshotPreprocessOutput.html" class="external-link">snapshotPreprocessOutput</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html" class="external-link">renderText</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"This is a random number:"</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span><span class="op">)</span>,</span>
<span>      <span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"[0-9.]+$"</span>, <span class="st">"&lt;a random number&gt;"</span>, <span class="va">value</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The output in the JSON snapshot will be:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>  <span class="er">"output":</span> <span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    <span class="dt">"random"</span><span class="fu">:</span> <span class="st">"This is a random number: &lt;a random number&gt;"</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="fu">}</span></span></code></pre></div>
<p>(This example is just for illustration purposes. Note that for this
example, the screenshots will still change each time the test is run, so
there are better solutions, like <a href="in-depth.html#controlling-randomness">setting the random
seed</a>.)</p>
<p>Input values can face the same issues, and they can also be modified
with <code><a href="https://rdrr.io/pkg/shiny/man/snapshotPreprocessInput.html" class="external-link">shiny::snapshotPreprocessInput()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="should-i-manually-shut-down-my-appdriver">Should I manually shut down my <code>AppDriver</code>?<a class="anchor" aria-label="anchor" href="#should-i-manually-shut-down-my-appdriver"></a>
</h2>
<p>For code completeness, you should call <code>app$stop()</code> at the
end of your tests to shut down the background Shiny process and current
Chromote Session.</p>
<p>If your R session is starting to feel more sluggish, you may want to
call <code>app$stop()</code> manually. Or if you are programmatically
creating many instances of <code>AppDriver</code>, you may want to call
<code>app$stop()</code> when the specific test is complete via
<code>withr::defer(app$stop())</code> right after initialization.</p>
</div>
<div class="section level2">
<h2 id="how-can-i-open-the-test-to-see-if-bookmarks-are-working">How can I open the test to see if bookmarks are working?<a class="anchor" aria-label="anchor" href="#how-can-i-open-the-test-to-see-if-bookmarks-are-working"></a>
</h2>
<p>Testing Shiny bookmarks requires the browser to be loaded with
specific query parameters. Luckily, you can use
<a href="https://rstudio.github.io/shinytest2/">shinytest2</a> to help you achieve this by running a local
<code>AppDriver</code> and another <code>AppDriver</code> that uses a
url with your specific query parameters! (<a href="https://github.com/rstudio/shinytest2/issues/219#issuecomment-1149162328" class="external-link">Original
code</a>, <a href="https://github.com/rstudio/shinytest2/tree/v0.2.0/tests/testthat/apps/download" class="external-link">Working
example</a>)</p>
<p>File: <code>tests/testthat//test-bookmark.R</code></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span><span class="st">"Bookmark works"</span>, <span class="op">{</span></span>
<span>  <span class="co"># Start local app in the background in test mode</span></span>
<span>  <span class="va">bg_app</span> <span class="op">&lt;-</span> <span class="fu">shinytest2</span><span class="fu">::</span><span class="va"><a href="../reference/AppDriver.html">AppDriver</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"path/to/shiny/app"</span><span class="op">)</span></span>
<span>  <span class="co"># Capture the background app's URL and add appropriate query parameters</span></span>
<span>  <span class="va">bookmark_url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">bg_app</span><span class="op">$</span><span class="fu">get_url</span><span class="op">(</span><span class="op">)</span>, <span class="st">"?_inputs_&amp;n=10"</span><span class="op">)</span></span>
<span>  <span class="co"># Open the bookmark URL in a new AppDriver object</span></span>
<span>  <span class="va">app</span> <span class="op">&lt;-</span> <span class="fu">shinytest2</span><span class="fu">::</span><span class="va"><a href="../reference/AppDriver.html">AppDriver</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">bookmark_url</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Run your tests on the bookmarked `app`</span></span>
<span>  <span class="va">app</span><span class="op">$</span><span class="fu">expect_values</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>File: <code>tests/testthat/_snaps/bookmark/001.json</code></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="dt">"input"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    <span class="dt">"._bookmark_"</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    <span class="dt">"caps"</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    <span class="dt">"txt"</span><span class="fu">:</span> <span class="st">"abcd"</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  <span class="dt">"output"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>    <span class="dt">"out"</span><span class="fu">:</span> <span class="st">"ABCD"</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  <span class="dt">"export"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="http://schloerke.com" class="external-link">Barret Schloerke</a>, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

  </div></footer>
</body>
</html>
