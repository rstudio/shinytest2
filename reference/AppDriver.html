<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Drive a Shiny application — AppDriver • shinytest2</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Drive a Shiny application — AppDriver"><meta name="description" content="This class starts a Shiny app in a new R session, along with chromote's
headless browser that can be used to simulate user actions. This provides
a full simulation of a Shiny app so that you can test user interactions
with a live app.
Methods described below are ordered by perceived popularity.
Expect methods are grouped next to their corresponding get methods."><meta property="og:description" content="This class starts a Shiny app in a new R session, along with chromote's
headless browser that can be used to simulate user actions. This provides
a full simulation of a Shiny app so that you can test user interactions
with a live app.
Methods described below are ordered by perceived popularity.
Expect methods are grouped next to their corresponding get methods."><meta property="og:image" content="https://rstudio.github.io/shinytest2/logo.svg"></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">shinytest2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/shinytest2.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/in-depth.html">Testing in depth</a></li>
    <li><a class="dropdown-item" href="../articles/robust.html">Robust testing</a></li>
    <li><a class="dropdown-item" href="../articles/use-application-audit.html">Auditing Shiny apps</a></li>
    <li><a class="dropdown-item" href="../articles/use-ci.html">Using shinytest2 with continuous integration</a></li>
    <li><a class="dropdown-item" href="../articles/use-package.html">Using shinytest2 with R packages</a></li>
    <li><a class="dropdown-item" href="../articles/using-monkey-testing.html">Monkey testing</a></li>
    <li><a class="dropdown-item" href="../articles/z-migration.html">Migrating from shinytest</a></li>
    <li><a class="dropdown-item" href="../articles/zzz-faq.html">Frequently Asked Questions</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rstudio/shinytest2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Drive a Shiny application</h1>
      <small class="dont-index">Source: <a href="https://github.com/rstudio/shinytest2/blob/main/R/app-driver.R" class="external-link"><code>R/app-driver.R</code></a></small>
      <div class="d-none name"><code>AppDriver.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This class starts a Shiny app in a new R session, along with <span class="pkg">chromote</span>'s
headless browser that can be used to simulate user actions. This provides
a full simulation of a Shiny app so that you can test user interactions
with a live app.</p>
<p>Methods described below are ordered by perceived popularity.
<em>Expect</em> methods are grouped next to their corresponding <em>get</em> methods.</p>
    </div>


    <div class="section level2">
    <h2 id="vignettes">Vignettes<a class="anchor" aria-label="anchor" href="#vignettes"></a></h2>



<p>Please see <a href="https://rstudio.github.io/shinytest2/articles/in-depth.html">Testing in depth</a>
for more details about the different expectation methods.</p>
<p>Please see <a href="https://rstudio.github.io/shinytest2/articles/robust.html">Robust testing</a>
for more details about the cost / benefits for each expectation method.</p>
    </div>
    <div class="section level2">
    <h2 id="test-mode">Test mode<a class="anchor" aria-label="anchor" href="#test-mode"></a></h2>



<p>To have your <code>AppDriver</code> retrieve values from your Shiny app, be sure to
set <code>shiny::runApp(test.mode = TRUE)</code> when running your Shiny app.</p>
<p>If you are deploying your Shiny app where you do not have control over
the call to <code><a href="https://rdrr.io/pkg/shiny/man/runApp.html" class="external-link">shiny::runApp()</a></code>, you can set <code>options(shiny.testmode = TRUE)</code> in
a <code>.Rprofile</code> file within your Shiny app directory.</p>
    </div>
    <div class="section level2">
    <h2 id="start-up-failure">Start-up failure<a class="anchor" aria-label="anchor" href="#start-up-failure"></a></h2>



<p>If the app throws an error during initialization, the <code>AppDriver</code> will
be stored in <code>rlang::last_error()$app</code>. This allows for the "failure
to initialize" to be signaled while also allowing for the <code>app</code> to be
retrieved after any initialization error has been thrown.</p>
    </div>
    <div class="section level2">
    <h2 id="exporting-reactive-values">Exporting reactive values<a class="anchor" aria-label="anchor" href="#exporting-reactive-values"></a></h2>



<p>Reactive values from within your Shiny application can be exported using the
method:
<a href="https://shiny.rstudio.com/reference/shiny/latest/exportTestValues.html" class="external-link"><code><a href="https://rdrr.io/pkg/shiny/man/exportTestValues.html" class="external-link">shiny::exportTestValues()</a></code></a>.
This underutilized method exposes internal values of your app
without needing to create a corresponding input value or output value.</p>
<p>For example:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="va">shiny_app</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h1</a></span><span class="op">(</span><span class="st">"Pythagorean theorem"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/numericInput.html" class="external-link">numericInput</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/numericInput.html" class="external-link">numericInput</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"B"</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html" class="external-link">verbatimTextOutput</a></span><span class="op">(</span><span class="st">"C"</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">a_squared</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html" class="external-link">req</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">A</span><span class="op">)</span>; <span class="va">input</span><span class="op">$</span><span class="va">A</span> <span class="op">*</span> <span class="va">input</span><span class="op">$</span><span class="va">A</span> <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="va">b_squared</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html" class="external-link">req</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">B</span><span class="op">)</span>; <span class="va">input</span><span class="op">$</span><span class="va">B</span> <span class="op">*</span> <span class="va">input</span><span class="op">$</span><span class="va">B</span> <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="va">c_squared</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="fu">a_squared</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">b_squared</span><span class="op">(</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="va">c_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu">c_squared</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html" class="external-link">renderText</a></span><span class="op">(</span><span class="op">{</span> <span class="fu">c_value</span><span class="op">(</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/exportTestValues.html" class="external-link">exportTestValues</a></span><span class="op">(</span></span>
<span>      a_squared <span class="op">=</span> <span class="op">{</span> <span class="fu">a_squared</span><span class="op">(</span><span class="op">)</span> <span class="op">}</span>,</span>
<span>      b_squared <span class="op">=</span> <span class="op">{</span> <span class="fu">b_squared</span><span class="op">(</span><span class="op">)</span> <span class="op">}</span>,</span>
<span>      c_squared <span class="op">=</span> <span class="op">{</span> <span class="fu">c_squared</span><span class="op">(</span><span class="op">)</span> <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/AppDriver.html">AppDriver</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">shiny_app</span><span class="op">)</span></span>
<span></span>
<span><span class="va">init_vals</span> <span class="op">&lt;-</span> <span class="va">app</span><span class="op">$</span><span class="fu">get_values</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">init_vals</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt; $ input :List of 2</span></span>
<span><span class="co">#&gt; ..$ A: int 3</span></span>
<span><span class="co">#&gt; ..$ B: int 4</span></span>
<span><span class="co">#&gt; $ output:List of 1</span></span>
<span><span class="co">#&gt; ..$ C: chr "5"</span></span>
<span><span class="co">#&gt; $ export:List of 3</span></span>
<span><span class="co">#&gt; ..$ a_squared: int 9</span></span>
<span><span class="co">#&gt; ..$ b_squared: int 16</span></span>
<span><span class="co">#&gt; ..$ c_squared: int 25</span></span></code></pre><p></p></div>
<p>These exported test values are only exposed when <code>shiny::runApp(test.mode = TRUE)</code>
is set.  <span class="pkg">shinytest2</span> sets this variable when running Shiny based app or
document.</p>
    </div>
    <div class="section level2">
    <h2 id="testthat-wrappers"><span class="pkg">testthat</span> wrappers<a class="anchor" aria-label="anchor" href="#testthat-wrappers"></a></h2>



<p>The two main expectation methods: <code>$expect_values()</code> and <code>$expect_screenshot()</code>
eventually wrap <code><a href="https://testthat.r-lib.org/reference/expect_snapshot_file.html" class="external-link">testthat::expect_snapshot_file()</a></code>.</p>
<p>Their underlying logic is similar to:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu">skip_on_cran</span><span class="op">(</span><span class="op">)</span> <span class="co"># AppDriver</span></span>
<span></span>
<span><span class="co">## Expect values</span></span>
<span><span class="va">tmpfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".json"</span><span class="op">)</span></span>
<span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/read_json.html" class="external-link">write_json</a></span><span class="op">(</span><span class="va">app</span><span class="op">$</span><span class="fu">get_values</span><span class="op">(</span><span class="op">)</span>, <span class="va">tmpfile</span><span class="op">)</span></span>
<span><span class="fu">expect_snapshot_file</span><span class="op">(</span></span>
<span>  <span class="va">tmpfile</span>,</span>
<span>  variant <span class="op">=</span> <span class="va">app</span><span class="op">$</span><span class="fu">get_variant</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  compare <span class="op">=</span> <span class="fu">testthat</span><span class="fu">::</span><span class="va"><a href="https://testthat.r-lib.org/reference/expect_snapshot_file.html" class="external-link">compare_file_text</a></span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## Expect screenshot</span></span>
<span><span class="va">tmpfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".png"</span><span class="op">)</span></span>
<span><span class="va">app</span><span class="op">$</span><span class="fu">get_screenshot</span><span class="op">(</span><span class="va">tmpfile</span><span class="op">)</span></span>
<span><span class="fu">expect_snapshot_file</span><span class="op">(</span></span>
<span>  <span class="va">tmpfile</span>,</span>
<span>  variant <span class="op">=</span> <span class="va">app</span><span class="op">$</span><span class="fu">get_variant</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  compare <span class="op">=</span> <span class="fu">testthat</span><span class="fu">::</span><span class="va"><a href="https://testthat.r-lib.org/reference/expect_snapshot_file.html" class="external-link">compare_file_binary</a></span></span>
<span><span class="op">)</span></span></code></pre><p></p></div>
<p>To update the snapshot values, you will need to run a variation of
<code><a href="https://testthat.r-lib.org/reference/snapshot_accept.html" class="external-link">testthat::snapshot_review()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="platform_variant.html">platform_variant()</a></code>, <code><a href="use_shinytest2.html">use_shinytest2_test()</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a></h2>

<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-AppDriver-new"><code>AppDriver$new()</code></a></p></li>
<li><p><a href="#method-AppDriver-view"><code>AppDriver$view()</code></a></p></li>
<li><p><a href="#method-AppDriver-click"><code>AppDriver$click()</code></a></p></li>
<li><p><a href="#method-AppDriver-set_inputs"><code>AppDriver$set_inputs()</code></a></p></li>
<li><p><a href="#method-AppDriver-upload_file"><code>AppDriver$upload_file()</code></a></p></li>
<li><p><a href="#method-AppDriver-expect_values"><code>AppDriver$expect_values()</code></a></p></li>
<li><p><a href="#method-AppDriver-get_value"><code>AppDriver$get_value()</code></a></p></li>
<li><p><a href="#method-AppDriver-get_values"><code>AppDriver$get_values()</code></a></p></li>
<li><p><a href="#method-AppDriver-expect_download"><code>AppDriver$expect_download()</code></a></p></li>
<li><p><a href="#method-AppDriver-get_download"><code>AppDriver$get_download()</code></a></p></li>
<li><p><a href="#method-AppDriver-expect_text"><code>AppDriver$expect_text()</code></a></p></li>
<li><p><a href="#method-AppDriver-get_text"><code>AppDriver$get_text()</code></a></p></li>
<li><p><a href="#method-AppDriver-expect_html"><code>AppDriver$expect_html()</code></a></p></li>
<li><p><a href="#method-AppDriver-get_html"><code>AppDriver$get_html()</code></a></p></li>
<li><p><a href="#method-AppDriver-expect_js"><code>AppDriver$expect_js()</code></a></p></li>
<li><p><a href="#method-AppDriver-get_js"><code>AppDriver$get_js()</code></a></p></li>
<li><p><a href="#method-AppDriver-run_js"><code>AppDriver$run_js()</code></a></p></li>
<li><p><a href="#method-AppDriver-expect_screenshot"><code>AppDriver$expect_screenshot()</code></a></p></li>
<li><p><a href="#method-AppDriver-get_screenshot"><code>AppDriver$get_screenshot()</code></a></p></li>
<li><p><a href="#method-AppDriver-wait_for_idle"><code>AppDriver$wait_for_idle()</code></a></p></li>
<li><p><a href="#method-AppDriver-wait_for_value"><code>AppDriver$wait_for_value()</code></a></p></li>
<li><p><a href="#method-AppDriver-wait_for_js"><code>AppDriver$wait_for_js()</code></a></p></li>
<li><p><a href="#method-AppDriver-expect_unique_names"><code>AppDriver$expect_unique_names()</code></a></p></li>
<li><p><a href="#method-AppDriver-get_dir"><code>AppDriver$get_dir()</code></a></p></li>
<li><p><a href="#method-AppDriver-get_url"><code>AppDriver$get_url()</code></a></p></li>
<li><p><a href="#method-AppDriver-get_window_size"><code>AppDriver$get_window_size()</code></a></p></li>
<li><p><a href="#method-AppDriver-set_window_size"><code>AppDriver$set_window_size()</code></a></p></li>
<li><p><a href="#method-AppDriver-get_chromote_session"><code>AppDriver$get_chromote_session()</code></a></p></li>
<li><p><a href="#method-AppDriver-get_variant"><code>AppDriver$get_variant()</code></a></p></li>
<li><p><a href="#method-AppDriver-get_logs"><code>AppDriver$get_logs()</code></a></p></li>
<li><p><a href="#method-AppDriver-log_message"><code>AppDriver$log_message()</code></a></p></li>
<li><p><a href="#method-AppDriver-stop"><code>AppDriver$stop()</code></a></p></li>
</ul></div><p></p><hr><a id="method-AppDriver-new"></a><div class="section">
<h3 id="method-new-">Method <code><a href="https://rdrr.io/r/methods/new.html" class="external-link">new()</a></code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>
<p>Initialize an <code>AppDriver</code> object</p><div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va"><a href="../reference/AppDriver.html">AppDriver</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  app_dir <span class="op">=</span> <span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_path.html" class="external-link">test_path</a></span><span class="op">(</span><span class="st">"../../"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  variant <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  load_timeout <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  timeout <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  wait <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  screenshot_args <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  expect_values_screenshot_args <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  check_names <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  view <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  height <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  width <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  clean_logs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  shiny_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  render_args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>app_dir</code></dt>
<dd><p>This value can be many different things:</p><ul><li><p>A directory containing your Shiny application or a run-time Shiny R
Markdown document.</p></li>
<li><p>A URL pointing to your shiny application. (Don't forget to set
<code>testmode = TRUE</code> when running your application!)</p></li>
<li><p>A Shiny application object which inherits from <code>"shiny.appobj"</code>.</p></li>
</ul><p>By default, <code>app_dir</code> is set to <code>test_path("../../")</code> to work in both
interactive and testing usage.</p>
<p>If a file path is not provided to <code>app_dir</code>, snapshots will be saved as
if the root of the Shiny application was the current directory.</p></dd>


<dt><code>...</code></dt>
<dd><p>Must be empty. Allows for parameter expansion.</p></dd>


<dt><code>name</code></dt>
<dd><p>Prefix value to use when saving testthat snapshot files. Ex:
<code>NAME-001.json</code>. Name <strong>must</strong> be unique when saving multiple snapshots
from within the same testing file. Otherwise, two different <code>AppDriver</code>
objects will be referencing the same files.</p></dd>


<dt><code>variant</code></dt>
<dd><p>If not-<code>NULL</code>, results will be saved in
<code>_snaps/{variant}/{test.md}</code>, so <code>variant</code> must be a single
string of alphanumeric characters suitable for use as a
directory name.</p>
<p>You can variants to deal with cases where the snapshot output
varies and you want to capture and test the variations.
Common use cases include variations for operating system, R
version, or version of key dependency. For example usage,
see <code><a href="platform_variant.html">platform_variant()</a></code>.</p></dd>


<dt><code>seed</code></dt>
<dd><p>An optional random seed to use before starting the application.
For apps that use R's random number generator, this can make their
behavior repeatable.</p></dd>


<dt><code>load_timeout</code></dt>
<dd><p>How long to wait for the app to load, in ms.
This includes the time to start R. Defaults to 15s.</p>
<p>If <code>load_timeout</code> is missing, the first numeric value found will be used:</p><ul><li><p>R option <code>options(shinytest2.load_timeout=)</code></p></li>
<li><p>System environment variable <code>SHINYTEST2_LOAD_TIMEOUT</code></p></li>
<li><p><code>15 * 1000</code> (15 seconds)</p></li>
</ul></dd>


<dt><code>timeout</code></dt>
<dd><p>Default number of milliseconds for any <code>timeout</code> or
<code>timeout_</code> parameter in the <code>AppDriver</code> class. Defaults to 4s.</p>
<p>If <code>timeout</code> is missing, the first numeric value found will be used:</p><ul><li><p>R option <code>options(shinytest2.timeout=)</code></p></li>
<li><p>System environment variable <code>SHINYTEST2_TIMEOUT</code></p></li>
<li><p><code>4 * 1000</code> (4 seconds)</p></li>
</ul></dd>


<dt><code>wait</code></dt>
<dd><p>If <code>TRUE</code>, <code>$wait_for_idle(duration = 200, timeout = load_timeout)</code>
will be called once the app has connected a new session, blocking until the
Shiny app is idle for 200ms.</p></dd>


<dt><code>screenshot_args</code></dt>
<dd><p>Default set of arguments to pass in to
<code><a href="https://rstudio.github.io/chromote/reference/ChromoteSession.html" class="external-link">chromote::ChromoteSession</a></code>'s <code>$get_screenshot()</code> method when taking
screenshots within <code>$expect_screenshot()</code>. To disable screenshots by
default, set to <code>FALSE</code>.</p></dd>


<dt><code>expect_values_screenshot_args</code></dt>
<dd><p>The value for <code>screenshot_args</code> when
producing a debug screenshot for <code>$expect_values()</code>. To disable debug
screenshots by default, set to <code>FALSE</code>.</p></dd>


<dt><code>check_names</code></dt>
<dd><p>Check if widget names are unique once the application
initially loads? If duplicate names are found on initialization, a
warning will be displayed.</p></dd>


<dt><code>view</code></dt>
<dd><p>Opens the <code><a href="https://rstudio.github.io/chromote/reference/ChromoteSession.html" class="external-link">chromote::ChromoteSession</a></code> in an interactive browser tab
before attempting to navigate to the Shiny app.</p></dd>


<dt><code>height, width</code></dt>
<dd><p>Window size to use when opening the
<code><a href="https://rstudio.github.io/chromote/reference/ChromoteSession.html" class="external-link">chromote::ChromoteSession</a></code>. Both <code>height</code> and <code>width</code> values must be non-null
values to be used.</p></dd>


<dt><code>clean_logs</code></dt>
<dd><p>Whether to remove the <code>stdout</code> and <code>stderr</code> Shiny app
logs when the <code>AppDriver</code> object is garbage collected.</p></dd>


<dt><code>shiny_args</code></dt>
<dd><p>A list of options to pass to <code><a href="https://rdrr.io/pkg/shiny/man/runApp.html" class="external-link">shiny::runApp()</a></code>. Ex:
<code>list(port = 8080)</code>.</p></dd>


<dt><code>render_args</code></dt>
<dd><p>Passed to <code>rmarkdown::run(render_args=)</code> for
interactive <code>.Rmd</code>s. Ex: <code>list(quiet = TRUE)</code></p></dd>


<dt><code>options</code></dt>
<dd><p>A list of <code><a href="https://rdrr.io/r/base/options.html" class="external-link">base::options()</a></code> to set in the Shiny
application's child R process. See <code><a href="https://rdrr.io/pkg/shiny/man/shinyOptions.html" class="external-link">shiny::shinyOptions()</a></code> for
inspiration. If <code>shiny.trace = TRUE</code>, then all WebSocket traffic will
be captured by <code>chromote</code> and time-stamped for logging purposes.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns">Returns<a class="anchor" aria-label="anchor" href="#returns"></a></h4>
<p>An object with class <code>AppDriver</code> and the many methods described in this documentation.</p>
</div>
<div class="section">
<h4 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
# Create an AppDriver from the Shiny app in the current directory
app &lt;- AppDriver()

# Create an AppDriver object from a different Shiny app directory
example_app &lt;- system.file("examples/01_hello", package = "shiny")
app &lt;- AppDriver(example_app)

# Expect consistent inital values
app$expect_values()
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-view"></a><div class="section">
<h3 id="method-view-">Method <code>view()</code><a class="anchor" aria-label="anchor" href="#method-view-"></a></h3>
<p>View the Shiny application</p>
<p>Calls <code>$view()</code> on the <code><a href="https://rstudio.github.io/chromote/reference/ChromoteSession.html" class="external-link">chromote::ChromoteSession</a></code> object to <em>view</em> your Shiny
application in a Chrome browser.</p>
<p>This method is very helpful for debugging while writing your tests.</p><div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">view</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="examples-1">Examples<a class="anchor" aria-label="anchor" href="#examples-1"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
# Open app in Chrome
app$view()
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-click"></a><div class="section">
<h3 id="method-click-">Method <code>click()</code><a class="anchor" aria-label="anchor" href="#method-click-"></a></h3>
<p>Click an element</p>
<p>Find a Shiny input/output value or DOM CSS selector and click it using
the <a href="https://www.w3schools.com/jsref/met_html_click.asp" class="external-link">DOM method <code>TAG.click()</code></a>.</p>
<p>This method can be used to click input buttons and other elements that
need to simulate a click action.</p><div class="section">
<h4 id="usage-2">Usage<a class="anchor" aria-label="anchor" href="#usage-2"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">click</span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  output <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  selector <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>
<p></p><div class="arguments"><dl><dt><code>input, output, selector</code></dt>
<dd><p>A name of an Shiny <code>input</code>/<code>output</code> value or
a DOM CSS selector. Only one of these may be used.</p></dd>


<dt><code>...</code></dt>
<dd><p>If <code>input</code> is used, all extra arguments are passed to
<code>$set_inputs(!!input := "click", ...)</code>. This means that the
<code>AppDriver</code> will wait until an output has been updated within the
specified <code>timeout_</code>. When clicking any other content, <code>...</code> must be empty.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="examples-2">Examples<a class="anchor" aria-label="anchor" href="#examples-2"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
app_path &lt;- system.file("examples/07_widgets", package = "shiny")
app &lt;- AppDriver$new(app_path)

tmpfile &lt;- write.csv(cars, "cars.csv")
app$upload_file(file1 = tmpfile)
cat(app$get_text("#view"))
app$set_inputs(dataset = "cars", obs = 6)
app$click("update")
cat(app$get_text("#view"))
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-set_inputs"></a><div class="section">
<h3 id="method-set-inputs-">Method <code>set_inputs()</code><a class="anchor" aria-label="anchor" href="#method-set-inputs-"></a></h3>
<p>Set input values</p>
<p>Set Shiny inputs by sending the value to the Chrome browser and
programmatically updating the values. Given <code>wait_ = TRUE</code>, the method will
not return until an output value has been updated.</p><div class="section">
<h4 id="usage-3">Usage<a class="anchor" aria-label="anchor" href="#usage-3"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">set_inputs</span><span class="op">(</span></span>
<span>  <span class="va">...</span>,</span>
<span>  wait_ <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  timeout_ <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  allow_no_input_binding_ <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  priority_ <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"input"</span>, <span class="st">"event"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-2">Arguments<a class="anchor" aria-label="anchor" href="#arguments-2"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>Name-value pairs, <code>component_name_1 = value_1, component_name_2 = value_2</code> etc.
Input with name <code>component_name_1</code> will be assigned value <code>value_1</code>.</p></dd>


<dt><code>wait_</code></dt>
<dd><p>Wait until all reactive updates have completed?</p></dd>


<dt><code>timeout_</code></dt>
<dd><p>Amount of time to wait before giving up (milliseconds).
Defaults to the resolved <code>timeout</code> value during the <code>AppDriver</code> initialization.</p></dd>


<dt><code>allow_no_input_binding_</code></dt>
<dd><p>When setting the value of an input, allow
it to set the value of an input even if that input does not have an
input binding. This is useful to replicate behavior like hovering over
a <span class="pkg">plotly</span> plot.</p></dd>


<dt><code>priority_</code></dt>
<dd><p>Sets the event priority. For expert use only: see
<a href="https://shiny.rstudio.com/articles/communicating-with-js.html#values-vs-events" class="external-link">https://shiny.rstudio.com/articles/communicating-with-js.html#values-vs-events</a> for details.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="examples-3">Examples<a class="anchor" aria-label="anchor" href="#examples-3"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
app_path &lt;- system.file("examples/07_widgets", package = "shiny")
app &lt;- AppDriver$new(app_path)

cat(app$get_text("#view"))
app$set_inputs(dataset = "cars", obs = 6)
app$click("update")
cat(app$get_text("#view"))
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-upload_file"></a><div class="section">
<h3 id="method-upload-file-">Method <code>upload_file()</code><a class="anchor" aria-label="anchor" href="#method-upload-file-"></a></h3>
<p>Upload a file</p>
<p>Uploads a file to the specified file input.</p><div class="section">
<h4 id="usage-4">Usage<a class="anchor" aria-label="anchor" href="#usage-4"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">upload_file</span><span class="op">(</span><span class="va">...</span>, wait_ <span class="op">=</span> <span class="cn">TRUE</span>, timeout_ <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-3">Arguments<a class="anchor" aria-label="anchor" href="#arguments-3"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>Name-path pair, e.g. <code>component_name = file_path</code>. The file located at
<code>file_path</code> will be uploaded to file input with name <code>component_name</code>.</p></dd>


<dt><code>wait_</code></dt>
<dd><p>Wait until all reactive updates have completed?</p></dd>


<dt><code>timeout_</code></dt>
<dd><p>Amount of time to wait before giving up (milliseconds).
Defaults to the resolved <code>timeout</code> value during the <code>AppDriver</code> initialization.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="examples-4">Examples<a class="anchor" aria-label="anchor" href="#examples-4"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
app_path &lt;- system.file("examples/09_upload", package = "shiny")
app &lt;- AppDriver$new(app_path)

# Save example file
tmpfile &lt;- tempfile(fileext = ".csv")
write.csv(cars, tmpfile, row.names = FALSE)

# Upload file to input named: file1
app$upload_file(file1 = tmpfile)
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-expect_values"></a><div class="section">
<h3 id="method-expect-values-">Method <code>expect_values()</code><a class="anchor" aria-label="anchor" href="#method-expect-values-"></a></h3>
<p>Expect <code>input</code>, <code>output</code>, and <code>export</code> values</p>
<p>A JSON snapshot is saved of given the results from the underlying call to <code>$get_values()</code>.</p>
<p>Note, values that contain environments or other values that will have
trouble serializing may not work well. Instead, these objects should be
manually inspected and have their components tested individually.</p>
<p>Please see <a href="https://rstudio.github.io/shinytest2/articles/robust.html">Robust testing</a> for more details.</p><div class="section">
<h4 id="usage-5">Usage<a class="anchor" aria-label="anchor" href="#usage-5"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">expect_values</span><span class="op">(</span></span>
<span>  <span class="va">...</span>,</span>
<span>  input <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  output <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  export <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  screenshot_args <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  transform <span class="op">=</span> <span class="va">transform</span>,</span>
<span>  cran <span class="op">=</span> <span class="fu">deprecated</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-4">Arguments<a class="anchor" aria-label="anchor" href="#arguments-4"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>Must be empty. Allows for parameter expansion.</p></dd>


<dt><code>input, output, export</code></dt>
<dd><p>Depending on which parameters are supplied, different return values can occur:
* If <code>input</code>, <code>output</code>, and <code>export</code> are all missing, then all values are included in the snapshot.
* If at least one <code>input</code>, <code>output</code>, or <code>export</code> is specified, then only the requested values are included in the snapshot.</p>
<p>The values supplied to each variable can be:
* A character vector of specific names to only include in the snapshot.
* <code>TRUE</code> to request that all values of that type are included in the snapshot.
* Anything else (e.g. <code>NULL</code> or <code>FALSE</code>) will result in the parameter being ignored.</p></dd>


<dt><code>screenshot_args</code></dt>
<dd><p>This value is passed along to
<code>$expect_screenshot()</code> where the resulting snapshot expectation is ignored. If
missing, the default value will be
<code>$new(expect_values_screenshot_args=)</code>.</p>
<p>The final value can either be:</p><ul><li><p><code>TRUE</code>: A screenshot of the browser's scrollable area will be taken with no delay</p></li>
<li><p><code>FALSE</code>: No screenshot will be taken</p></li>
<li><p>A named list of arguments. These arguments are passed directly to
<code><a href="https://rstudio.github.io/chromote/reference/ChromoteSession.html" class="external-link">chromote::ChromoteSession</a></code>'s <code>$get_screenshot()</code> method. The <code>selector</code>
and <code>delay</code> will default to <code>"html"</code> and <code>0</code> respectively.</p></li>
</ul></dd>


<dt><code>name</code></dt>
<dd><p>The file name to be used for the snapshot. The file extension
will be overwritten to <code>.json</code>. By default, the <code>name</code> supplied to
<code>app</code> on initialization with a counter will be used (e.g. <code>"NAME-001.json"</code>).</p></dd>


<dt><code>transform</code></dt>
<dd><p>Optionally, a function to scrub sensitive or stochastic text
from the output. Should take a character vector of lines as input and
return a modified character vector as output.</p></dd>


<dt><code>cran</code></dt>
<dd><p>Deprecated. With <code>AppDriver</code> never testing on CRAN,
this parameter no longer has any effect.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-1">Returns<a class="anchor" aria-label="anchor" href="#returns-1"></a></h4>
<p>The result of the snapshot expectation</p>
</div>
<div class="section">
<h4 id="examples-5">Examples<a class="anchor" aria-label="anchor" href="#examples-5"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
library(shiny)
shiny_app &lt;- shinyApp(
  fluidPage(
    h1("Pythagorean theorem"),
    numericInput("A", "A", 3),
    numericInput("B", "B", 4),
    verbatimTextOutput("C"),
  ),
  function(input, output) {
    a_squared &lt;- reactive({ req(input$A); input$A * input$A })
    b_squared &lt;- reactive({ req(input$B); input$B * input$B })
    c_squared &lt;- reactive({ a_squared() + b_squared() })
    c_value &lt;- reactive({ sqrt(c_squared()) })
    output$C &lt;- renderText({ c_value() })

    exportTestValues(
      a_squared = { a_squared() },
      b_squared = { b_squared() },
      c_squared = { c_squared() }
    )
  }
)

app &lt;- AppDriver$new(shiny_app)

# Snapshot all known values
app$expect_values()

# Snapshot only `export` values
app$expect_values(export = TRUE)

# Snapshot values `"A"` from `input` and `"C"` from `output`
app$expect_values(input = "A", output = "C")
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-get_value"></a><div class="section">
<h3 id="method-get-value-">Method <code>get_value()</code><a class="anchor" aria-label="anchor" href="#method-get-value-"></a></h3>
<p>Get a single <code>input</code>, <code>output</code>, or <code>export</code> value</p>
<p>This is a helper function around <code>$get_values()</code> to retrieve a single
<code>input</code>, <code>output</code>, or <code>export</code> value. Only a single <code>input</code>, <code>output</code>, or
<code>export</code> value can be used.</p>
<p>Note, values that contain environments or other values that will have
trouble serializing to RDS may not work well.</p><div class="section">
<h4 id="usage-6">Usage<a class="anchor" aria-label="anchor" href="#usage-6"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">get_value</span><span class="op">(</span></span>
<span>  <span class="va">...</span>,</span>
<span>  input <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  output <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  export <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  hash_images <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-5">Arguments<a class="anchor" aria-label="anchor" href="#arguments-5"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>Must be empty. Allows for parameter expansion.</p></dd>


<dt><code>input, output, export</code></dt>
<dd><p>One of these variable should contain a single
string value. If more than one value is specified or no values are
specified, an error will be thrown.</p></dd>


<dt><code>hash_images</code></dt>
<dd><p>If <code>TRUE</code>, images will be hashed before being returned.
Otherwise, all images will return their full data64 encoded value.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-2">Returns<a class="anchor" aria-label="anchor" href="#returns-2"></a></h4>
<p>The requested <code>input</code>, <code>output</code>, or <code>export</code> value.</p>
</div>
<div class="section">
<h4 id="examples-6">Examples<a class="anchor" aria-label="anchor" href="#examples-6"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
app_path &lt;- system.file("examples/04_mpg", package = "shiny")
app &lt;- AppDriver$new(app_path)

# Retrieve a single value
app$get_value(output = "caption")
#&gt; [1] "mpg ~ cyl"
# Equivalent code using `$get_values()`
app$get_values(output = "caption")$output$caption
#&gt; [1] "mpg ~ cyl"
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-get_values"></a><div class="section">
<h3 id="method-get-values-">Method <code>get_values()</code><a class="anchor" aria-label="anchor" href="#method-get-values-"></a></h3>
<p>Get <code>input</code>, <code>output</code>, and <code>export</code> values</p>
<p>Retrieves a list of all known <code>input</code>, <code>output</code>, or <code>export</code> values. This
method is a core method when inspecting your Shiny app.</p>
<p>Note, values that contain environments or other values that will have
trouble serializing may not work well.</p><div class="section">
<h4 id="usage-7">Usage<a class="anchor" aria-label="anchor" href="#usage-7"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">get_values</span><span class="op">(</span></span>
<span>  <span class="va">...</span>,</span>
<span>  input <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  output <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  export <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  hash_images <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-6">Arguments<a class="anchor" aria-label="anchor" href="#arguments-6"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>Must be empty. Allows for parameter expansion.</p></dd>


<dt><code>input, output, export</code></dt>
<dd><p>Depending on which parameters are supplied, different return values can occur:
* If <code>input</code>, <code>output</code>, and <code>export</code> are all missing, then all values are included in the snapshot.
* If at least one <code>input</code>, <code>output</code>, or <code>export</code> is specified, then only the requested values are included in the snapshot.</p>
<p>The values supplied to each variable can be:
* A character vector of specific names to only include in the snapshot.
* <code>TRUE</code> to request that all values of that type are included in the snapshot.
* Anything else (e.g. <code>NULL</code> or <code>FALSE</code>) will result in the parameter being ignored.</p></dd>


<dt><code>hash_images</code></dt>
<dd><p>If <code>TRUE</code>, images will be hashed before being returned.
Otherwise, all images will return their full data64 encoded value.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-3">Returns<a class="anchor" aria-label="anchor" href="#returns-3"></a></h4>
<p>A named list of all inputs, outputs, and export values.</p>
</div>
<div class="section">
<h4 id="examples-7">Examples<a class="anchor" aria-label="anchor" href="#examples-7"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
library(shiny)
shiny_app &lt;- shinyApp(
  fluidPage(
    h1("Pythagorean theorem"),
    numericInput("A", "A", 3),
    numericInput("B", "B", 4),
    verbatimTextOutput("C"),
  ),
  function(input, output) {
    a_squared &lt;- reactive({ req(input$A); input$A * input$A })
    b_squared &lt;- reactive({ req(input$B); input$B * input$B })
    c_squared &lt;- reactive({ a_squared() + b_squared() })
    c_value &lt;- reactive({ sqrt(c_squared()) })
    output$C &lt;- renderText({ c_value() })

    exportTestValues(
      a_squared = { a_squared() },
      b_squared = { b_squared() },
      c_squared = { c_squared() }
    )
  }
)

app &lt;- AppDriver$new(shiny_app)

# Show all known values
str(app$get_values())
#&gt; List of 3
#&gt; $ input :List of 2
#&gt; ..$ A: int 3
#&gt; ..$ B: int 4
#&gt; $ output:List of 1
#&gt; ..$ C: chr "5"
#&gt; $ export:List of 3
#&gt; ..$ a_squared: int 9
#&gt; ..$ b_squared: int 16
#&gt; ..$ c_squared: int 25

# Get only `export` values
str(app$get_values(export = TRUE))
#&gt; List of 1
#&gt; $ export:List of 3
#&gt; ..$ a_squared: int 9
#&gt; ..$ b_squared: int 16
#&gt; ..$ c_squared: int 25

# Get values `"A"` from `input` and `"C"` from `output`
str(app$get_values(input = "A", output = "C"))
#&gt; List of 2
#&gt; $ input :List of 1
#&gt; ..$ A: int 3
#&gt; $ output:List of 1
#&gt; ..$ C: chr "5"
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-expect_download"></a><div class="section">
<h3 id="method-expect-download-">Method <code>expect_download()</code><a class="anchor" aria-label="anchor" href="#method-expect-download-"></a></h3>
<p>Expect a downloadable file</p>
<p>Given a <code><a href="https://rdrr.io/pkg/shiny/man/downloadButton.html" class="external-link">shiny::downloadButton()</a></code>/<code><a href="https://rdrr.io/pkg/shiny/man/downloadButton.html" class="external-link">shiny::downloadLink()</a></code> <code>output</code> ID, the corresponding
file will be downloaded and saved as a snapshot file.</p><div class="section">
<h4 id="usage-8">Usage<a class="anchor" aria-label="anchor" href="#usage-8"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">expect_download</span><span class="op">(</span></span>
<span>  <span class="va">output</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  compare <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  transform <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cran <span class="op">=</span> <span class="fu">deprecated</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-7">Arguments<a class="anchor" aria-label="anchor" href="#arguments-7"></a></h4>
<p></p><div class="arguments"><dl><dt><code>output</code></dt>
<dd><p><code>output</code> ID of <code><a href="https://rdrr.io/pkg/shiny/man/downloadButton.html" class="external-link">shiny::downloadButton()</a></code>/<code><a href="https://rdrr.io/pkg/shiny/man/downloadButton.html" class="external-link">shiny::downloadLink()</a></code></p></dd>


<dt><code>...</code></dt>
<dd><p>Must be empty. Allows for parameter expansion.</p></dd>


<dt><code>compare</code></dt>
<dd><p>This value is passed through to <code><a href="https://testthat.r-lib.org/reference/expect_snapshot_file.html" class="external-link">testthat::expect_snapshot_file()</a></code>.
By default it is set to <code>NULL</code> which will default to <code><a href="https://testthat.r-lib.org/reference/expect_snapshot_file.html" class="external-link">testthat::compare_file_text</a></code> if <code>name</code>
has extension <code>.r</code>, <code>.R</code>, <code>.Rmd</code>, <code>.md</code>, or <code>.txt</code>, and otherwise uses
<code><a href="https://testthat.r-lib.org/reference/expect_snapshot_file.html" class="external-link">testthat::compare_file_binary</a></code>.</p></dd>


<dt><code>name</code></dt>
<dd><p>File name to save file to (including file name extension). The default, <code>NULL</code>,
generates an ascending sequence of names: <code>001.download</code>,
<code>002.download</code>, etc.</p></dd>


<dt><code>transform</code></dt>
<dd><p>Optionally, a function to scrub sensitive or stochastic text
from the output. Should take a character vector of lines as input and
return a modified character vector as output.</p></dd>


<dt><code>cran</code></dt>
<dd><p>Deprecated. With <code>AppDriver</code> never testing on CRAN,
this parameter no longer has any effect.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="examples-8">Examples<a class="anchor" aria-label="anchor" href="#examples-8"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
app_path &lt;- system.file("examples/10_download", package = "shiny")
app &lt;- AppDriver$new(app_path)

# Save snapshot of rock.csv as 001.download
# Save snapshot value of `rock.csv` to capture default file name
app$expect_download("downloadData", compare = testthat::compare_file_text)
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-get_download"></a><div class="section">
<h3 id="method-get-download-">Method <code>get_download()</code><a class="anchor" aria-label="anchor" href="#method-get-download-"></a></h3>
<p>Get downloadable file</p>
<p>Given a <code><a href="https://rdrr.io/pkg/shiny/man/downloadButton.html" class="external-link">shiny::downloadButton()</a></code>/<code><a href="https://rdrr.io/pkg/shiny/man/downloadButton.html" class="external-link">shiny::downloadLink()</a></code> <code>output</code> ID, the corresponding
file will be downloaded and saved as a file.</p><div class="section">
<h4 id="usage-9">Usage<a class="anchor" aria-label="anchor" href="#usage-9"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">get_download</span><span class="op">(</span><span class="va">output</span>, filename <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-8">Arguments<a class="anchor" aria-label="anchor" href="#arguments-8"></a></h4>
<p></p><div class="arguments"><dl><dt><code>output</code></dt>
<dd><p><code>output</code> ID of <code><a href="https://rdrr.io/pkg/shiny/man/downloadButton.html" class="external-link">shiny::downloadButton()</a></code>/<code><a href="https://rdrr.io/pkg/shiny/man/downloadButton.html" class="external-link">shiny::downloadLink()</a></code></p></dd>


<dt><code>filename</code></dt>
<dd><p>File path to save the downloaded file to.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-4">Returns<a class="anchor" aria-label="anchor" href="#returns-4"></a></h4>
<p><code>$get_download()</code> will return the final save location of the file. This
location can change depending on the value of <code>filename</code> and response
headers.</p>
<p>Location logic:</p><ul><li><p>If <code>filename</code> is not NULL, <code>filename</code> will be returned.</p></li>
<li><p>If a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition" class="external-link"><code>content-disposition</code> <code>filename</code></a> is provided,
then a temp file containing this <code>filename</code> will be
returned.</p></li>
<li><p>Otherwise, a temp file ending in <code>.download</code> will be returned.</p></li>
</ul></div>
<div class="section">
<h4 id="examples-9">Examples<a class="anchor" aria-label="anchor" href="#examples-9"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
app_path &lt;- system.file("examples/10_download", package = "shiny")
app &lt;- AppDriver$new(app_path)

# Get rock.csv as a tempfile
app$get_download("downloadData")
#&gt; [1] "/TEMP/PATH/rock.csv"

# Get rock.csv as a "./myfile.csv"
app$get_download("downloadData", filename = "./myfile.csv")
#&gt; [1] "./myfile.csv"
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-expect_text"></a><div class="section">
<h3 id="method-expect-text-">Method <code>expect_text()</code><a class="anchor" aria-label="anchor" href="#method-expect-text-"></a></h3>
<p>Expect snapshot of UI text</p>
<p><code>$expect_text()</code> will extract the text value of all matching elements via
<code>TAG.textContent</code> and store them in a snapshot file. This method is more
robust to internal package change as only the text values will be
maintained. Note, this method will not retrieve any <code>&lt;input /&gt;</code> value's
text content, e.g. text inputs or text areas, as the input values are not
stored in the live HTML.</p>
<p>When possible, use <code>$expect_text()</code> over <code>$expect_html()</code> to allow
package authors room to alter their HTML structures. The resulting array
of <code>TAG.textContent</code> values found will be stored in a snapshot file.</p>
<p>Please see <a href="https://rstudio.github.io/shinytest2/articles/robust.html">Robust testing</a> for more details.</p><div class="section">
<h4 id="usage-10">Usage<a class="anchor" aria-label="anchor" href="#usage-10"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">expect_text</span><span class="op">(</span><span class="va">selector</span>, <span class="va">...</span>, cran <span class="op">=</span> <span class="fu">deprecated</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-9">Arguments<a class="anchor" aria-label="anchor" href="#arguments-9"></a></h4>
<p></p><div class="arguments"><dl><dt><code>selector</code></dt>
<dd><p>A DOM CSS selector to be passed into <code>document.querySelectorAll()</code></p></dd>


<dt><code>...</code></dt>
<dd><p>Must be empty. Allows for parameter expansion.</p></dd>


<dt><code>cran</code></dt>
<dd><p>Deprecated. With <code>AppDriver</code> never testing on CRAN,
this parameter no longer has any effect.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="examples-10">Examples<a class="anchor" aria-label="anchor" href="#examples-10"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
hello_app &lt;- system.file("examples/01_hello", package = "shiny")
app &lt;- AppDriver$new(hello_app)

# Make a snapshot of `"Hello Shiny!"`
app$expect_text("h2")
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-get_text"></a><div class="section">
<h3 id="method-get-text-">Method <code>get_text()</code><a class="anchor" aria-label="anchor" href="#method-get-text-"></a></h3>
<p>Get UI text</p>
<p><code>$get_text()</code> will extract the text value of all matching elements via
<code>TAG.textContent</code>. Note, this method will not retrieve any <code>&lt;input /&gt;</code>
value's text content, e.g. text inputs or text areas, as the input values
are not stored in the live HTML.</p><div class="section">
<h4 id="usage-11">Usage<a class="anchor" aria-label="anchor" href="#usage-11"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">get_text</span><span class="op">(</span><span class="va">selector</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-10">Arguments<a class="anchor" aria-label="anchor" href="#arguments-10"></a></h4>
<p></p><div class="arguments"><dl><dt><code>selector</code></dt>
<dd><p>A DOM CSS selector to be passed into <code>document.querySelectorAll()</code></p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-5">Returns<a class="anchor" aria-label="anchor" href="#returns-5"></a></h4>
<p>A vector of character values</p>
</div>
<div class="section">
<h4 id="examples-11">Examples<a class="anchor" aria-label="anchor" href="#examples-11"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
hello_app &lt;- system.file("examples/01_hello", package = "shiny")
app &lt;- AppDriver$new(hello_app)

app$get_text("h2")
#&gt; [1] "Hello Shiny!"
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-expect_html"></a><div class="section">
<h3 id="method-expect-html-">Method <code>expect_html()</code><a class="anchor" aria-label="anchor" href="#method-expect-html-"></a></h3>
<p>Expect snapshot of UI HTML</p>
<p><code>$expect_html()</code> will extract the full DOM structures of each matching
element and store them in a snapshot file. This method captures internal
DOM structure which may be brittle to changes by external authors or
dependencies.</p>
<p>Note, this method will not retrieve any <code>&lt;input /&gt;</code> value's
text content, e.g. text inputs or text areas, as the input values are not
stored in the live HTML.</p>
<p>When possible, use <code>$expect_text()</code> over <code>$expect_html()</code> to allow
package authors room to alter their HTML structures. The resulting array
of <code>TAG.textContent</code> values found will be stored in a snapshot file.</p>
<p>Please see <a href="https://rstudio.github.io/shinytest2/articles/robust.html">Robust testing</a> for more details.</p><div class="section">
<h4 id="usage-12">Usage<a class="anchor" aria-label="anchor" href="#usage-12"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">expect_html</span><span class="op">(</span><span class="va">selector</span>, <span class="va">...</span>, outer_html <span class="op">=</span> <span class="cn">TRUE</span>, cran <span class="op">=</span> <span class="fu">deprecated</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-11">Arguments<a class="anchor" aria-label="anchor" href="#arguments-11"></a></h4>
<p></p><div class="arguments"><dl><dt><code>selector</code></dt>
<dd><p>A DOM selector to be passed into <code>document.querySelectorAll()</code></p></dd>


<dt><code>...</code></dt>
<dd><p>Must be empty. Allows for parameter expansion.</p></dd>


<dt><code>outer_html</code></dt>
<dd><p>If <code>TRUE</code> (default), the full DOM structure will be returned (<code>TAG.outerHTML</code>).
If <code>FALSE</code>, the full DOM structure of the child elements will be returned (<code>TAG.innerHTML</code>).</p></dd>


<dt><code>cran</code></dt>
<dd><p>Deprecated. With <code>AppDriver</code> never testing on CRAN,
this parameter no longer has any effect.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="examples-12">Examples<a class="anchor" aria-label="anchor" href="#examples-12"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
app_path &lt;- system.file("examples/04_mpg", package = "shiny")
app &lt;- AppDriver$new(app_path)

# Save a snapshot of the `caption` output
app$expect_html("#caption")
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-get_html"></a><div class="section">
<h3 id="method-get-html-">Method <code>get_html()</code><a class="anchor" aria-label="anchor" href="#method-get-html-"></a></h3>
<p>Get UI HTML</p>
<p><code>$get()</code> will extract the full DOM structures of each matching
element. This method captures internal
DOM structure which may be brittle to changes by external authors or
dependencies.</p>
<p>Note, this method will not retrieve any <code>&lt;input /&gt;</code> value's
text content, e.g. text inputs or text areas, as the input values are not
stored in the live HTML.</p>
<p>Please see <a href="https://rstudio.github.io/shinytest2/articles/robust.html">Robust testing</a> for more details.</p><div class="section">
<h4 id="usage-13">Usage<a class="anchor" aria-label="anchor" href="#usage-13"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">get_html</span><span class="op">(</span><span class="va">selector</span>, <span class="va">...</span>, outer_html <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-12">Arguments<a class="anchor" aria-label="anchor" href="#arguments-12"></a></h4>
<p></p><div class="arguments"><dl><dt><code>selector</code></dt>
<dd><p>A DOM selector to be passed into <code>document.querySelectorAll()</code></p></dd>


<dt><code>...</code></dt>
<dd><p>Must be empty. Allows for parameter expansion.</p></dd>


<dt><code>outer_html</code></dt>
<dd><p>If <code>TRUE</code>, the full DOM structure will be returned (<code>TAG.outerHTML</code>).
If <code>FALSE</code>, the full DOM structure of the child elements will be returned (<code>TAG.innerHTML</code>).</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="examples-13">Examples<a class="anchor" aria-label="anchor" href="#examples-13"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
app_path &lt;- system.file("examples/03_reactivity", package = "shiny")
app &lt;- AppDriver$new(app_path, check_names = FALSE)

app$set_inputs(caption = "Custom value!")
cat(app$get_html(".shiny-input-container")[1])
#&gt; &lt;div class="form-group shiny-input-container"&gt;
#&gt;   &lt;label class="control-label" id="caption-label" for="caption"&gt;Caption:&lt;/label&gt;
#&gt;   &lt;input id="caption" type="text" class="form-control shiny-bound-input" value="Data Summary"&gt;
#&gt; &lt;/div&gt;
## ^^ No update to the DOM of `caption`
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-expect_js"></a><div class="section">
<h3 id="method-expect-js-">Method <code>expect_js()</code><a class="anchor" aria-label="anchor" href="#method-expect-js-"></a></h3>
<p>Expect snapshot of JavaScript script output</p>
<p>This is a building block function that may be called by other functions.
For example, <code>$expect_text()</code> and <code>$expect_html()</code> are thin wrappers around this function.</p>
<p>Once the <code>script</code> has executed, the JSON result will be saved to a snapshot file.</p><div class="section">
<h4 id="usage-14">Usage<a class="anchor" aria-label="anchor" href="#usage-14"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">expect_js</span><span class="op">(</span></span>
<span>  script <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  file <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  timeout <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  pre_snapshot <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cran <span class="op">=</span> <span class="fu">deprecated</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-13">Arguments<a class="anchor" aria-label="anchor" href="#arguments-13"></a></h4>
<p></p><div class="arguments"><dl><dt><code>script</code></dt>
<dd><p>A string containing the JavaScript script to be executed.</p></dd>


<dt><code>...</code></dt>
<dd><p>Must be empty. Allows for parameter expansion.</p></dd>


<dt><code>file</code></dt>
<dd><p>A file containing JavaScript code to be read and used as the <code>script</code>. Only one of <code>script</code> or <code>file</code> can be specified.</p></dd>


<dt><code>timeout</code></dt>
<dd><p>Amount of time to wait before giving up (milliseconds).
Defaults to the resolved <code>timeout</code> value during the <code>AppDriver</code> initialization.</p></dd>


<dt><code>pre_snapshot</code></dt>
<dd><p>A function to be called on the result of the script before taking the snapshot.
<code>$expect_html()</code> and <code>$expect_text()</code> both use <code><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist()</a></code>.</p></dd>


<dt><code>cran</code></dt>
<dd><p>Deprecated. With <code>AppDriver</code> never testing on CRAN,
this parameter no longer has any effect.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="examples-14">Examples<a class="anchor" aria-label="anchor" href="#examples-14"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
app_path &lt;- system.file("examples/07_widgets", package = "shiny")
app &lt;- AppDriver$new(app_path)

# Track how many clicks are given to `#update` button
app$run_js("
  window.test_counter = 0;
  $('#update').click(() =&gt; window.test_counter++);
")
app$set_inputs(obs = 20)
# Click the update button, incrementing the counter
app$click("update")
# Save a snapshot of number of clicks (1)
app$expect_js("window.test_counter;")
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-get_js"></a><div class="section">
<h3 id="method-get-js-">Method <code>get_js()</code><a class="anchor" aria-label="anchor" href="#method-get-js-"></a></h3>
<p>Execute JavaScript code in the browser and return the result</p>
<p>This function will block the local R session until the code has finished
executing its <em>tick</em> in the browser. If a <code>Promise</code> is returned from the
script, <code>$get_js()</code> will wait for the promise to resolve. To have
JavaScript code execute asynchronously, wrap the code in a Promise object
and have the script return an atomic value.</p>
<p>Arguments will have to be inserted into the script as there is not access
to <code>arguments</code>. This can be done with commands like <code><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste()</a></code>. If using
<code><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue::glue()</a></code>, be sure to use uncommon <code>.open</code> and <code>.close</code> values to
avoid having to double all <code>{</code> and <code>}</code>.</p><div class="section">
<h4 id="usage-15">Usage<a class="anchor" aria-label="anchor" href="#usage-15"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">get_js</span><span class="op">(</span></span>
<span>  script <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  file <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  timeout <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-14">Arguments<a class="anchor" aria-label="anchor" href="#arguments-14"></a></h4>
<p></p><div class="arguments"><dl><dt><code>script</code></dt>
<dd><p>JavaScript to execute. If a JavaScript Promise is returned,
the R session will block until the promise has been resolved and return
the value.</p></dd>


<dt><code>...</code></dt>
<dd><p>Must be empty. Allows for parameter expansion.</p></dd>


<dt><code>file</code></dt>
<dd><p>A (local) file containing JavaScript code to be read and used
as the <code>script</code>. Only one of <code>script</code> or <code>file</code> can be specified.</p></dd>


<dt><code>timeout</code></dt>
<dd><p>Amount of time to wait before giving up (milliseconds).
Defaults to the resolved <code>timeout</code> value during the <code>AppDriver</code> initialization.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-6">Returns<a class="anchor" aria-label="anchor" href="#returns-6"></a></h4>
<p>Result of the <code>script</code> (or <code>file</code> contents)</p>
</div>
<div class="section">
<h4 id="examples-15">Examples<a class="anchor" aria-label="anchor" href="#examples-15"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
library(shiny)
shiny_app &lt;- shinyApp(h1("Empty App"), function(input, output) { })
app &lt;- AppDriver$new(shiny_app)

# Execute JavaScript code in the app's browser
app$get_js("1 + 1;")
#&gt; [1] 2

# Execute a JavaScript Promise. Return the resolved value.
app$get_js("
  new Promise((resolve) =&gt; {
    setTimeout(() =&gt; resolve(1 + 1), 1000)
  }).
  then((value) =&gt; value + 1);
")
#&gt; [1] 3

# With escaped arguments
loc_field &lt;- "hostname"
js_txt &lt;- paste0("window.location[", jsonlite::toJSON(loc_field, auto_unbox = TRUE), "]")
app$get_js(js_txt)
#&gt; [1] "127.0.0.1"

# With `glue::glue()`
js_txt &lt;- glue::glue_data(
  lapply(
    list(x = 40, y = 2),
    jsonlite::toJSON,
    auto_unbox = TRUE
  ),
  .open = "&lt;", .close = "&gt;",
  "let answer = function(a, b) {\n",
  "  return a + b;\n",
  "};\n",
  "answer(&lt;x&gt;, &lt;y&gt;);\n"
)
app$get_js(js_txt)
#&gt; [1] 42
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-run_js"></a><div class="section">
<h3 id="method-run-js-">Method <code>run_js()</code><a class="anchor" aria-label="anchor" href="#method-run-js-"></a></h3>
<p>Execute JavaScript code in the browser</p>
<p>This function will block the local R session until the code has finished
executing its <em>tick</em> in the browser.</p>
<p>The final result of the code will be ignored and not returned to the R session.</p><div class="section">
<h4 id="usage-16">Usage<a class="anchor" aria-label="anchor" href="#usage-16"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">run_js</span><span class="op">(</span></span>
<span>  script <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  file <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  timeout <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-15">Arguments<a class="anchor" aria-label="anchor" href="#arguments-15"></a></h4>
<p></p><div class="arguments"><dl><dt><code>script</code></dt>
<dd><p>JavaScript to execute.</p></dd>


<dt><code>...</code></dt>
<dd><p>Must be empty. Allows for parameter expansion.</p></dd>


<dt><code>file</code></dt>
<dd><p>A (local) file containing JavaScript code to be read and used
as the <code>script</code>. Only one of <code>script</code> or <code>file</code> can be specified.</p></dd>


<dt><code>timeout</code></dt>
<dd><p>Amount of time to wait before giving up (milliseconds).
Defaults to the resolved <code>timeout</code> value during the <code>AppDriver</code> initialization.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="examples-16">Examples<a class="anchor" aria-label="anchor" href="#examples-16"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
library(shiny)
shiny_app &lt;- shinyApp(h1("Empty App"), function(input, output) { })
app &lt;- AppDriver$new(shiny_app)

# Get JavaScript answer from the app's browser
app$get_js("1 + 1")
#&gt; [1] 2
# Execute JavaScript code in the app's browser
app$run_js("1 + 1")
# (Returns `app` invisibly)

# With escaped arguments
loc_field &lt;- "hostname"
js_txt &lt;- paste0("window.location[", jsonlite::toJSON(loc_field, auto_unbox = TRUE), "]")
app$run_js(js_txt)
app$get_js(js_txt)
#&gt; [1] "127.0.0.1"
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-expect_screenshot"></a><div class="section">
<h3 id="method-expect-screenshot-">Method <code>expect_screenshot()</code><a class="anchor" aria-label="anchor" href="#method-expect-screenshot-"></a></h3>
<p>Expect a screenshot of the Shiny application</p>
<p>This method takes a screenshot of the application (of only the <code>selector</code>
area) and compares the image to the expected image.</p>
<p>Please be aware that this method is very brittle to changes outside of your Shiny application.
These changes can include:</p><ul><li><p>running on a different R version</p></li>
<li><p>running on a different in operating system</p></li>
<li><p>using a different default system font</p></li>
<li><p>using different package versions
These differences are explicitly clear when working with plots.</p></li>
</ul><p>Unless absolutely necessary for application consistency, it is strongly
recommended to use other expectation methods.</p><div class="section">
<h4 id="usage-17">Usage<a class="anchor" aria-label="anchor" href="#usage-17"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">expect_screenshot</span><span class="op">(</span></span>
<span>  <span class="va">...</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"shinytest2.compare_screenshot.threshold"</span>, <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>  kernel_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"shinytest2.compare_screenshot.kernel_size"</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  screenshot_args <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  delay <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  selector <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  compare <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cran <span class="op">=</span> <span class="fu">deprecated</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-16">Arguments<a class="anchor" aria-label="anchor" href="#arguments-16"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>Must be empty. Allows for parameter expansion.</p></dd>


<dt><code>threshold</code></dt>
<dd><p>Parameter supplied to <code><a href="compare_screenshot_threshold.html">compare_screenshot_threshold()</a></code>
when using the default <code>compare</code> method. The default value can be set
globally with the <code>shinytest2.compare_screenshot.threshold</code> option.</p>
<p>If the value of <code>threshold</code> is <code>NULL</code>,
<code><a href="compare_screenshot_threshold.html">compare_screenshot_threshold()</a></code> will act like
<code><a href="https://testthat.r-lib.org/reference/expect_snapshot_file.html" class="external-link">testthat::compare_file_binary</a></code>. However, if <code>threshold</code> is a
positive number, it will be compared against the largest convolution
value found if the two images fail a <code><a href="https://testthat.r-lib.org/reference/expect_snapshot_file.html" class="external-link">testthat::compare_file_binary</a></code>
comparison.</p>
<p>Which value should I use? Threshold values values below 5 help deter
false-positive screenshot comparisons (such as inconsistent rounded
corners). Larger values in the 10s and 100s will help find <em>real</em>
changes. However, not all values are one size fits all and you will
need to play with a threshold that fits your needs.</p></dd>


<dt><code>kernel_size</code></dt>
<dd><p>Parameter supplied to
<code><a href="compare_screenshot_threshold.html">compare_screenshot_threshold()</a></code> when using the default <code>compare</code>
method. The <code>kernel_size</code> represents the height and width of the
convolution kernel applied to the pixel differences. This integer-like
value should be relatively small. The default value can be set globally
with the <code>shinytest2.compare_screenshot.kernel_size</code> option.</p></dd>


<dt><code>screenshot_args</code></dt>
<dd><p>This named list of arguments is passed along to
<code><a href="https://rstudio.github.io/chromote/reference/ChromoteSession.html" class="external-link">chromote::ChromoteSession</a></code>'s <code>$get_screenshot()</code> method. If missing, the
value will default to <code>$new(screenshot_args=)</code>.</p>
<p>If <code>screenshot_args</code> is:</p><ul><li><p><code>TRUE</code>: A screenshot of the browser's scrollable area will be taken
with no delay</p></li>
<li><p>A named list of arguments: Arguments passed directly to
<code><a href="https://rstudio.github.io/chromote/reference/ChromoteSession.html" class="external-link">chromote::ChromoteSession</a></code>'s <code>$get_screenshot()</code> method. The
<code>delay</code> argument will default to <code>0</code> seconds. The <code>selector</code> argument
can take two special values in addition to being a CSS DOM selector.</p><ul><li><p><code>"scrollable_area"</code> (default): The entire scrollable area will be
captured. Typically this is your browser's viewport size, but it
can be larger if the page is scrollable. This value works well with
Apps that contain elements whose calculated dimensions may be
different than their presented size.</p></li>
<li><p><code>"viewport"</code>: This value will capture the browser's viewport in its
current viewing location, height, and width. It will only capture
what is currently being seen with <code>$view()</code>.</p></li>
</ul><p>In <code>v0.3.0</code>, the default <code>selector</code> value was changed from the HTML
DOM selector (<code>"html"</code>) to entire scrollable area
(<code>"scrollable_area"</code>).</p></li>
</ul></dd>


<dt><code>delay</code></dt>
<dd><p>The number of <strong>seconds</strong> to wait before taking the screenshot.
This value can be supplied as <code>delay</code> or <code>screenshot_args$delay</code>, with the
<code>delay</code> parameter having preference.</p></dd>


<dt><code>selector</code></dt>
<dd><p>The selector is a CSS selector that will be used to select a
portion of the page to be captured. This value can be supplied as
<code>selector</code> or <code>screenshot_args$selector</code>, with the <code>selector</code> parameter
having preference.</p>
<p>In <code>v0.3.0</code>, two special <code>selector</code> values were added:</p><ul><li><p><code>"scrollable_area"</code> (default): The entire scrollable area will be
captured. Typically this is your browser's viewport size, but it can be
larger if the page is scrollable. This value works well with Apps that
contain elements whose calculated dimensions may be different than their
presented size.</p></li>
<li><p><code>"viewport"</code>: This value will capture the browser's viewport in its
current viewing location, height, and width. It will only capture
what is currently being seen with <code>$view()</code>.</p></li>
</ul><p>In <code>v0.3.0</code>, the default <code>selector</code> value was changed from the HTML DOM
selector (<code>"html"</code>) to entire scrollable area (<code>"scrollable_area"</code>).</p></dd>


<dt><code>compare</code></dt>
<dd><p>A function used to compare the screenshot snapshot files.
The function should take two inputs, the paths to the <code>old</code> and <code>new</code>
snapshot, and return either <code>TRUE</code> or <code>FALSE</code>.</p>
<p><code>compare</code> defaults to a function that wraps around
<code>compare_screenshot_threshold(old, new, threshold = threshold, kernel_size = kernel_size, quiet = quiet)</code>. Note: if <code>threshold</code> is
<code>NULL</code> (default), <code>compare</code> will behave as if
<code><a href="https://testthat.r-lib.org/reference/expect_snapshot_file.html" class="external-link">testthat::compare_file_binary()</a></code> was provided, comparing the two
images byte-by-byte.</p></dd>


<dt><code>quiet</code></dt>
<dd><p>Parameter supplied to <code><a href="compare_screenshot_threshold.html">compare_screenshot_threshold()</a></code>
when using the default <code>compare</code> method. If <code>FALSE</code>, diagnostic
information will be presented when the computed value is larger than a
non-<code>NULL</code> <code>threshold</code> value.</p></dd>


<dt><code>name</code></dt>
<dd><p>The file name to be used for the snapshot. The file extension
will overwritten to <code>.png</code>. By default, the <code>name</code> supplied to
<code>app</code> on initialization with a counter will be used (e.g. <code>"NAME-001.png"</code>).</p></dd>


<dt><code>cran</code></dt>
<dd><p>Deprecated. With <code>AppDriver</code> never testing on CRAN,
this parameter no longer has any effect.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="examples-17">Examples<a class="anchor" aria-label="anchor" href="#examples-17"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
# These example lines should be performed in a `./tests/testthat`
# test file so that snapshot files can be properly saved

app_path &lt;- system.file("examples/01_hello", package = "shiny")
app &lt;- AppDriver$new(app_path, variant = platform_variant())

# Expect a full size screenshot to be pixel perfect
app$expect_screenshot()

# Images are brittle when containing plots
app$expect_screenshot(selector = "#distPlot")

# Test with more threshold in pixel value differences
# Helps with rounded corners
app$expect_screenshot(threshold = 10)

# Equivalent expectations
app$expect_screenshot() # default
app$expect_screenshot(threshold = NULL)
app$expect_screenshot(compare = testthat::compare_file_binary)
expect_snapshot_file(
  app$get_screenshot(),
  variant = app$get_variant(),
  compare = testthat::compare_file_binary
)

# Equivalent expectations
app$expect_screenshot(threshold = 3, kernel_size = 5)
app$expect_screenshot(compare = function(old, new) {
  compare_screenshot_threshold(
    old, new,
    threshold = 3,
    kernel_size = 5
  )
})
expect_screenshot_file(
  app$get_screenshot(),
  variant = app$get_variant(),
  compare = function(old, new) {
    compare_screenshot_threshold(
      old, new,
      threshold = 3,
      kernel_size = 5
    )
  }
)

# Take a screenshot of the entire scrollable area
app$expect_screenshot()
app$expect_screenshot(selector = "scrollable_area")

## Take a screenshot of the current viewport
# Shrink the window to be smaller than the app
app$set_window_size(400, 500)
# Scroll the viewport just a bit
app$run_js("window.scroll(30, 70)")
# Take screenshot of browser viewport
app$expect_screenshot(selector = "viewport")
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-get_screenshot"></a><div class="section">
<h3 id="method-get-screenshot-">Method <code>get_screenshot()</code><a class="anchor" aria-label="anchor" href="#method-get-screenshot-"></a></h3>
<p>Take a screenshot</p>
<p>Take a screenshot of the Shiny application.</p><div class="section">
<h4 id="usage-18">Usage<a class="anchor" aria-label="anchor" href="#usage-18"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">get_screenshot</span><span class="op">(</span></span>
<span>  file <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  screenshot_args <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  delay <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  selector <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-17">Arguments<a class="anchor" aria-label="anchor" href="#arguments-17"></a></h4>
<p></p><div class="arguments"><dl><dt><code>file</code></dt>
<dd><p>If <code>NULL</code>, then the image will be displayed to the current
Graphics Device. If a file path, then the screenshot will be saved to
that file.</p></dd>


<dt><code>...</code></dt>
<dd><p>Must be empty. Allows for parameter expansion.</p></dd>


<dt><code>screenshot_args</code></dt>
<dd><p>This named list of arguments is passed along to
<code><a href="https://rstudio.github.io/chromote/reference/ChromoteSession.html" class="external-link">chromote::ChromoteSession</a></code>'s <code>$get_screenshot()</code> method. If missing, the
value will default to <code>$new(screenshot_args=)</code>.</p>
<p>If <code>screenshot_args</code> is:</p><ul><li><p><code>TRUE</code>: A screenshot of the browser's scrollable area will be taken with no delay</p></li>
<li><p>A named list of arguments: Arguments passed directly to
<code><a href="https://rstudio.github.io/chromote/reference/ChromoteSession.html" class="external-link">chromote::ChromoteSession</a></code>'s <code>$get_screenshot()</code> method. The <code>delay</code>
argument will default to <code>0</code> seconds. The <code>selector</code> argument can take two
special values in addition to being a CSS DOM selector.</p><ul><li><p><code>"scrollable_area"</code> (default): The entire scrollable area will be
captured. Typically this is your browser's viewport size, but it can be
larger if the page is scrollable. This value works well with Apps that
contain elements whose calculated dimensions may be different than
their presented size.</p></li>
<li><p><code>"viewport"</code>: This value will capture the browser's viewport in its
current viewing location, height, and width. It will only capture
what is currently being seen with <code>$view()</code>.</p></li>
</ul><p>In <code>v0.3.0</code>, the default <code>selector</code> value was changed from the HTML DOM
selector (<code>"html"</code>) to entire scrollable area (<code>"scrollable_area"</code>).</p></li>
</ul><p>If <code>screenshot_args=FALSE</code> is provided, the parameter will be ignored and a
screenshot will be taken with default behavior.</p></dd>


<dt><code>delay</code></dt>
<dd><p>The number of <strong>seconds</strong> to wait before taking the screenshot.
This value can be supplied as <code>delay</code> or <code>screenshot_args$delay</code>, with the
<code>delay</code> parameter having preference.</p></dd>


<dt><code>selector</code></dt>
<dd><p>The selector is a CSS selector that will be used to select a
portion of the page to be captured. This value can be supplied as
<code>selector</code> or <code>screenshot_args$selector</code>, with the <code>selector</code> parameter
having preference.</p>
<p>In <code>v0.3.0</code>, two special <code>selector</code> values were added:</p><ul><li><p><code>"scrollable_area"</code> (default): The entire scrollable area will be
captured. Typically this is your browser's viewport size, but it can be
larger if the page is scrollable. This value works well with Apps that
contain elements whose calculated dimensions may be different than their
presented size.</p></li>
<li><p><code>"viewport"</code>: This value will capture the browser's viewport in its
current viewing location, height, and width. It will only capture
what is currently being seen with <code>$view()</code>.</p></li>
</ul><p>In <code>v0.3.0</code>, the default <code>selector</code> value was changed from the HTML DOM
selector (<code>"html"</code>) to entire scrollable area (<code>"scrollable_area"</code>).</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="examples-18">Examples<a class="anchor" aria-label="anchor" href="#examples-18"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
app_path &lt;- system.file("examples/01_hello", package = "shiny")
app &lt;- AppDriver$new(app_path)

# Display in graphics device
app$get_screenshot()

# Update bins then display `"disPlot"` in graphics device
app$set_inputs(bins = 10)
app$get_screenshot(selector = "#distPlot")

# Save screenshot to file and view it
tmpfile &lt;- tempfile(fileext = ".png")
app$get_screenshot(tmpfile)
showimage::show_image(tmpfile)
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-wait_for_idle"></a><div class="section">
<h3 id="method-wait-for-idle-">Method <code>wait_for_idle()</code><a class="anchor" aria-label="anchor" href="#method-wait-for-idle-"></a></h3>
<p>Wait for Shiny to not be busy (idle) for a set amount of time</p>
<p>Waits until Shiny has not been busy for a set duration of time, e.g. no
reactivity is updating or has occurred.</p>
<p>This is useful, for example, when waiting for your application to
initialize or if you've resized the window with <code>$set_window_size()</code> and
want to make sure all plot redrawing is complete before take a
screenshot.</p>
<p>By default,</p><ul><li><p><code>$new(wait = TRUE)</code> waits for Shiny to not be busy after initializing
the application</p></li>
<li><p><code>$set_window_size(wait = TRUE)</code> waits for Shiny to not be busy after
resizing the window.)</p></li>
</ul><div class="section">
<h4 id="usage-19">Usage<a class="anchor" aria-label="anchor" href="#usage-19"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">wait_for_idle</span><span class="op">(</span>duration <span class="op">=</span> <span class="fl">500</span>, timeout <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-18">Arguments<a class="anchor" aria-label="anchor" href="#arguments-18"></a></h4>
<p></p><div class="arguments"><dl><dt><code>duration</code></dt>
<dd><p>How long Shiny must be idle (in ms) before unblocking the
R session.</p></dd>


<dt><code>timeout</code></dt>
<dd><p>Amount of time to wait before giving up (milliseconds).
Defaults to the resolved <code>timeout</code> value during the <code>AppDriver</code> initialization.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-7">Returns<a class="anchor" aria-label="anchor" href="#returns-7"></a></h4>
<p><code>invisible(self)</code> if Shiny stabilizes within the <code>timeout</code>.
Otherwise an error will be thrown</p>
</div>
<div class="section">
<h4 id="examples-19">Examples<a class="anchor" aria-label="anchor" href="#examples-19"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
app_path &lt;- system.file("examples/01_hello", package = "shiny")
app &lt;- AppDriver$new(app_path)

pre_value &lt;- app$get_value(output = "distPlot")
# Update bins value
app$set_inputs(bins = 10, wait_ = FALSE)
middle_value &lt;- app$get_value(output = "distPlot")
app$wait_for_idle()
post_value &lt;- app$get_value(output = "distPlot")

# No guarantee that these values are different
identical(pre_value, middle_value)
# Will not be equal
identical(pre_value, post_value)

# ---------------------
## Change the screen size to trigger a plot update
pre_value &lt;- app$get_value(output = "distPlot")
app$set_window_size(height = 1080, width = 1920, wait = FALSE)
middle_value &lt;- app$get_value(output = "distPlot")
app$wait_for_idle()
post_value &lt;- app$get_value(output = "distPlot")

# No guarantee that these values are different
identical(pre_value, middle_value)
# Will not be equal
identical(pre_value, post_value)
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-wait_for_value"></a><div class="section">
<h3 id="method-wait-for-value-">Method <code>wait_for_value()</code><a class="anchor" aria-label="anchor" href="#method-wait-for-value-"></a></h3>
<p>Wait for a new Shiny value</p>
<p>Waits until an <code>input</code>, <code>output</code>, or <code>export</code> Shiny value is not one of
<code>ignore</code>d values, or the <code>timeout</code> is reached.</p>
<p>Only a single <code>input</code>, <code>output</code>, or <code>export</code> value may be used.</p>
<p>This function can be useful in helping determine if an application
has finished processing a complex reactive situation.</p><div class="section">
<h4 id="usage-20">Usage<a class="anchor" aria-label="anchor" href="#usage-20"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">wait_for_value</span><span class="op">(</span></span>
<span>  <span class="va">...</span>,</span>
<span>  input <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  output <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  export <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  ignore <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="st">""</span><span class="op">)</span>,</span>
<span>  timeout <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  interval <span class="op">=</span> <span class="fl">400</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-19">Arguments<a class="anchor" aria-label="anchor" href="#arguments-19"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>Must be empty. Allows for parameter expansion.</p></dd>


<dt><code>input, output, export</code></dt>
<dd><p>A name of an input, output, or export value.
Only one of these parameters may be used.</p></dd>


<dt><code>ignore</code></dt>
<dd><p>List of possible values to ignore when checking for
updates.</p></dd>


<dt><code>timeout</code></dt>
<dd><p>Amount of time to wait before giving up (milliseconds).
Defaults to the resolved <code>timeout</code> value during the <code>AppDriver</code> initialization.</p></dd>


<dt><code>interval</code></dt>
<dd><p>How often to check for the condition, in ms.</p></dd>


<dt><code>timeout_</code></dt>
<dd><p>Amount of time to wait for a new <code>output</code> value before giving up (milliseconds).
Defaults to the resolved <code>timeout</code> value during the <code>AppDriver</code> initialization.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-8">Returns<a class="anchor" aria-label="anchor" href="#returns-8"></a></h4>
<p>Newly found value</p>
</div>
<div class="section">
<h4 id="examples-20">Examples<a class="anchor" aria-label="anchor" href="#examples-20"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
library(shiny)
shiny_app &lt;- shinyApp(
  fluidPage(
    h1("Dynamic output"),
    actionButton("display", "Display UI"),
    uiOutput("dym1"),
  ),
  function(input, output) {
    output$dym1 &lt;- renderUI({
      req(input$display)
      Sys.sleep(runif(1, max = 2)) # Artificial calculations
      tagList(
        sliderInput("slider1", "Slider #1", 0, 100, 25),
        uiOutput("dym2")
      )
    })
    output$dym2 &lt;- renderUI({
      Sys.sleep(runif(1, max = 2)) # Artificial calculations
      tagList(
        sliderInput("slider2", "Slider #2", 0, 100, 50),
        "Total:", verbatimTextOutput("total")
      )
    })
    output$total &lt;- renderText({
      req(input$slider1, input$slider2)
      input$slider1 + input$slider2
    })
  }
)

app &lt;- AppDriver$new(shiny_app)

# Create UI / output values
app$click("display")
# Wait for total to be calculated (or have a non-NULL value)
new_total_value &lt;- app$wait_for_value(output = "total")
#&gt; [1] "75"
app$get_value(output = "total")
#&gt; [1] "75"
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-wait_for_js"></a><div class="section">
<h3 id="method-wait-for-js-">Method <code>wait_for_js()</code><a class="anchor" aria-label="anchor" href="#method-wait-for-js-"></a></h3>
<p>Wait for a JavaScript expression to be true</p>
<p>Waits until a JavaScript <code>expr</code>ession evaluates to <code>true</code> or the
<code>timeout</code> is exceeded.</p><div class="section">
<h4 id="usage-21">Usage<a class="anchor" aria-label="anchor" href="#usage-21"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">wait_for_js</span><span class="op">(</span><span class="va">script</span>, timeout <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span>, interval <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-20">Arguments<a class="anchor" aria-label="anchor" href="#arguments-20"></a></h4>
<p></p><div class="arguments"><dl><dt><code>script</code></dt>
<dd><p>A string containing JavaScript code. This code must
eventually return a <a href="https://developer.mozilla.org/en-US/docs/Glossary/Truthy" class="external-link"><code>true</code>thy value</a> or a
timeout error will be thrown.</p></dd>


<dt><code>timeout</code></dt>
<dd><p>How long the script has to return a <code>true</code>thy value (milliseconds).
Defaults to the resolved <code>timeout</code> value during the <code>AppDriver</code> initialization.</p></dd>


<dt><code>interval</code></dt>
<dd><p>How often to check for the condition (milliseconds).</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-9">Returns<a class="anchor" aria-label="anchor" href="#returns-9"></a></h4>
<p><code>invisible(self)</code> if expression evaluates to <code>true</code> without error
within the timeout. Otherwise an error will be thrown</p>
</div>
<div class="section">
<h4 id="examples-21">Examples<a class="anchor" aria-label="anchor" href="#examples-21"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
shiny_app &lt;- shinyApp(h1("Empty App"), function(input, output) { })
app &lt;- AppDriver$new(shiny_app)

# Contrived example:
# Wait until `Date.now()` returns a number that ends in a 5. (0 - 10 seconds)
system.time(
  app$wait_for_js("Math.floor((Date.now() / 1000) % 10) == 5;")
)

## A second example where we run the contents of a JavaScript file
## and use the result to wait for a condition
app$run_js(file = "complicated_file.js")
app$wait_for_js("complicated_condition();")
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-expect_unique_names"></a><div class="section">
<h3 id="method-expect-unique-names-">Method <code>expect_unique_names()</code><a class="anchor" aria-label="anchor" href="#method-expect-unique-names-"></a></h3>
<p>Expect unique input and output names.</p>
<p>If the HTML has duplicate input or output elements with matching <code>id</code>
values, this function will throw an error. It is similar to
<code>AppDriver$new(check_names = TRUE)</code>, but asserts that no warnings are
displayed.</p>
<p>This method will not throw if a single input and a single output have the
same name.</p><div class="section">
<h4 id="usage-22">Usage<a class="anchor" aria-label="anchor" href="#usage-22"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">expect_unique_names</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="examples-22">Examples<a class="anchor" aria-label="anchor" href="#examples-22"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
shiny_app &lt;- shinyApp(
  ui = fluidPage(
    # Duplicate input IDs: `"text"`
    textInput("text", "Text 1"),
    textInput("text", "Text 2")
  ),
  server = function(input, output) {
    # empty
  }
)
# Initial checking for unique names (default behavior)
app &lt;- AppDriver$new(shiny_app, check_names = TRUE)
#&gt; Warning:
#&gt; ! Shiny inputs should have unique HTML id values.
#&gt; i The following HTML id values are not unique:
#&gt; • text
app$stop()

# Manually assert that all names are unique
app &lt;- AppDriver$new(shiny_app, check_names = FALSE)
app$expect_unique_names()
#&gt; Error: `app_check_unique_names(self, private)` threw an unexpected warning.
#&gt; Message: ! Shiny inputs should have unique HTML id values.
#&gt; i The following HTML id values are not unique:
#&gt;   • text
#&gt; Class:   rlang_warning/warning/condition
app$stop()
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-get_dir"></a><div class="section">
<h3 id="method-get-dir-">Method <code>get_dir()</code><a class="anchor" aria-label="anchor" href="#method-get-dir-"></a></h3>
<p>Retrieve the Shiny app path</p><div class="section">
<h4 id="usage-23">Usage<a class="anchor" aria-label="anchor" href="#usage-23"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">get_dir</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="returns-10">Returns<a class="anchor" aria-label="anchor" href="#returns-10"></a></h4>
<p>The directory containing the Shiny application or Shiny runtime
document. If a URL was provided to <code>app_dir</code> during initialization, the
current directory will be returned.</p>
</div>
<div class="section">
<h4 id="examples-23">Examples<a class="anchor" aria-label="anchor" href="#examples-23"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
app_path &lt;- system.file("examples/01_hello", package = "shiny")
app &lt;- AppDriver$new(app_path)

identical(app$get_dir(), app_path)
#&gt; [1] TRUE
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-get_url"></a><div class="section">
<h3 id="method-get-url-">Method <code>get_url()</code><a class="anchor" aria-label="anchor" href="#method-get-url-"></a></h3>
<p>Retrieve the Shiny app URL</p><div class="section">
<h4 id="usage-24">Usage<a class="anchor" aria-label="anchor" href="#usage-24"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">get_url</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="returns-11">Returns<a class="anchor" aria-label="anchor" href="#returns-11"></a></h4>
<p>URL where the Shiny app is being hosted</p>
</div>
<div class="section">
<h4 id="examples-24">Examples<a class="anchor" aria-label="anchor" href="#examples-24"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
app_path &lt;- system.file("examples/01_hello", package = "shiny")
app &lt;- AppDriver$new(app_path)

browseURL(app$get_url())
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-get_window_size"></a><div class="section">
<h3 id="method-get-window-size-">Method <code>get_window_size()</code><a class="anchor" aria-label="anchor" href="#method-get-window-size-"></a></h3>
<p>Get window size</p>
<p>Get current size of the browser window, as list of numeric scalars
named <code>width</code> and <code>height</code>.</p><div class="section">
<h4 id="usage-25">Usage<a class="anchor" aria-label="anchor" href="#usage-25"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">get_window_size</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="examples-25">Examples<a class="anchor" aria-label="anchor" href="#examples-25"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
app_path &lt;- system.file("examples/01_hello", package = "shiny")
app &lt;- AppDriver$new(app_path)

app$get_window_size()
#&gt; $width
#&gt; [1] 992
#&gt;
#&gt; $height
#&gt; [1] 1323
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-set_window_size"></a><div class="section">
<h3 id="method-set-window-size-">Method <code>set_window_size()</code><a class="anchor" aria-label="anchor" href="#method-set-window-size-"></a></h3>
<p>Sets size of the browser window.</p><div class="section">
<h4 id="usage-26">Usage<a class="anchor" aria-label="anchor" href="#usage-26"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">set_window_size</span><span class="op">(</span><span class="va">width</span>, <span class="va">height</span>, wait <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-21">Arguments<a class="anchor" aria-label="anchor" href="#arguments-21"></a></h4>
<p></p><div class="arguments"><dl><dt><code>width, height</code></dt>
<dd><p>Height and width of browser, in pixels.</p></dd>


<dt><code>wait</code></dt>
<dd><p>If <code>TRUE</code>, <code>$wait_for_idle()</code> will be called after setting
the window size. This will block until any width specific items (such
as plots) that need to be re-rendered.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="examples-26">Examples<a class="anchor" aria-label="anchor" href="#examples-26"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
app_path &lt;- system.file("examples/01_hello", package = "shiny")
# Set init window size
app &lt;- AppDriver$new(app_path, height = 1400, width = 1000)

app$get_window_size()
#&gt; $width
#&gt; [1] 1000
#&gt;
#&gt; $height
#&gt; [1] 1400

# Manually set the window size
app$set_window_size(height = 1080, width = 1920)
app$get_window_size()
#&gt; $width
#&gt; [1] 1920
#&gt;
#&gt; $height
#&gt; [1] 1080
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-get_chromote_session"></a><div class="section">
<h3 id="method-get-chromote-session-">Method <code>get_chromote_session()</code><a class="anchor" aria-label="anchor" href="#method-get-chromote-session-"></a></h3>
<p>Get Chromote Session</p>
<p>Get the <code><a href="https://rstudio.github.io/chromote/reference/ChromoteSession.html" class="external-link">chromote::ChromoteSession</a></code> object from the <span class="pkg">chromote</span> package.</p><div class="section">
<h4 id="usage-27">Usage<a class="anchor" aria-label="anchor" href="#usage-27"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">get_chromote_session</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="returns-12">Returns<a class="anchor" aria-label="anchor" href="#returns-12"></a></h4>
<p><code><a href="https://rstudio.github.io/chromote/reference/ChromoteSession.html" class="external-link">chromote::ChromoteSession</a></code> R6 object</p>
</div>
<div class="section">
<h4 id="examples-27">Examples<a class="anchor" aria-label="anchor" href="#examples-27"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
app_path &lt;- system.file("examples/01_hello", package = "shiny")
app &lt;- AppDriver$new(app_path)

b &lt;- app$get_chromote_session()
b$Runtime$evaluate("1 + 1")
#&gt; $result
#&gt; $result$type
#&gt; [1] "number"
#&gt;
#&gt; $result$value
#&gt; [1] 2
#&gt;
#&gt; $result$description
#&gt; [1] "2"
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-get_variant"></a><div class="section">
<h3 id="method-get-variant-">Method <code>get_variant()</code><a class="anchor" aria-label="anchor" href="#method-get-variant-"></a></h3>
<p>Get the variant</p>
<p>Get the <code>variant</code> supplied during initialization</p><div class="section">
<h4 id="usage-28">Usage<a class="anchor" aria-label="anchor" href="#usage-28"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">get_variant</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="returns-13">Returns<a class="anchor" aria-label="anchor" href="#returns-13"></a></h4>
<p>The <code>variant</code> value supplied during initialization or <code>NULL</code> if
no value was supplied.</p>
</div>
<div class="section">
<h4 id="examples-28">Examples<a class="anchor" aria-label="anchor" href="#examples-28"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
app_path &lt;- system.file("examples/01_hello", package = "shiny")

app &lt;- AppDriver$new(app_path)

app$get_variant()
#&gt; NULL

app &lt;- AppDriver$new(app_path, variant = platform_variant())
app$get_variant()
#&gt; [1] "mac-4.1"
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-get_logs"></a><div class="section">
<h3 id="method-get-logs-">Method <code>get_logs()</code><a class="anchor" aria-label="anchor" href="#method-get-logs-"></a></h3>
<p>Get all logs</p>
<p>Retrieve all of the debug logs that have been recorded.</p><div class="section">
<h4 id="usage-29">Usage<a class="anchor" aria-label="anchor" href="#usage-29"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">get_logs</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="returns-14">Returns<a class="anchor" aria-label="anchor" href="#returns-14"></a></h4>
<p>A data.frame with the following columns:</p><ul><li><p><code>workerid</code>: The shiny worker ID found within the browser</p></li>
<li><p><code>timestamp</code>: POSIXct timestamp of the message</p></li>
<li><p><code>location</code>: The location of the message was found. One of three values:</p><ul><li><p><code>"shinytest2"</code>: Occurs when <code>$log_message()</code> is called</p></li>
<li><p><code>"shiny"</code>: <code>stdin</code> and <code>stdout</code> messages from the Shiny server. Note <code><a href="https://rdrr.io/r/base/message.html" class="external-link">message()</a></code> output is sent to <code>stdout</code>.</p></li>
<li><p><code>"chromote"</code>: Captured by the <span class="pkg">chromote</span> event handlers. See
<a href="https://chromedevtools.github.io/devtools-protocol/1-3/Runtime/#event-consoleAPICalled" class="external-link">console API</a>,
<a href="https://chromedevtools.github.io/devtools-protocol/1-3/Runtime/#event-exceptionThrown" class="external-link">exception thrown</a>,
<a href="https://chromedevtools.github.io/devtools-protocol/1-3/Network/#event-webSocketFrameSent" class="external-link">websocket sent</a>, and
<a href="https://chromedevtools.github.io/devtools-protocol/1-3/Network/#event-webSocketFrameReceived" class="external-link">websocket received</a>
for more details</p></li>
</ul></li>
<li><p><code>level</code>: For a given location, there are different types of log levels.</p><ul><li><p><code>"shinytest2"</code>: <code>"log"</code>; Only log messages are captured.</p></li>
<li><p><code>"shiny"</code>: <code>"stdout"</code> or <code>"stderr"</code>; Note, <code><a href="https://rdrr.io/r/base/message.html" class="external-link">message()</a></code> output is sent
to <code>stderr</code>.</p></li>
<li><p><code>"chromote"</code>: Correspond to any level of a JavaScript
<code>console.LEVEL()</code> function call. Typically, these are "log"<code>and</code>"error"<code>but can include</code>"info"<code>, </code>"debug"<code>, and </code>"warn"<code>. If </code>options(shiny.trace = TRUE)<code>, then the level will recorded as </code>"websocket"`.</p></li>
</ul></li>
</ul></div>
<div class="section">
<h4 id="examples-29">Examples<a class="anchor" aria-label="anchor" href="#examples-29"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
app1 &lt;- AppDriver$new(system.file("examples/01_hello", package = "shiny"))

app1$get_logs()
#&gt; {shinytest2} R  info   10:00:28.86 Start AppDriver initialization
#&gt; {shinytest2} R  info   10:00:28.86 Starting Shiny app
#&gt; {shinytest2} R  info   10:00:29.76 Creating new ChromoteSession
#&gt; {shinytest2} R  info   10:00:30.56 Navigating to Shiny app
#&gt; {shinytest2} R  info   10:00:30.70 Injecting shiny-tracer.js
#&gt; {chromote}   JS info   10:00:30.75 shinytest2; jQuery found
#&gt; {chromote}   JS info   10:00:30.77 shinytest2; Waiting for shiny session to connect
#&gt; {chromote}   JS info   10:00:30.77 shinytest2; Loaded
#&gt; {shinytest2} R  info   10:00:30.77 Waiting for Shiny to become ready
#&gt; {chromote}   JS info   10:00:30.90 shinytest2; Connected
#&gt; {chromote}   JS info   10:00:30.95 shinytest2; shiny:busy
#&gt; {shinytest2} R  info   10:00:30.98 Waiting for Shiny to become idle for 200ms within 15000ms
#&gt; {chromote}   JS info   10:00:30.98 shinytest2; Waiting for Shiny to be stable
#&gt; {chromote}   JS info   10:00:31.37 shinytest2; shiny:idle
#&gt; {chromote}   JS info   10:00:31.38 shinytest2; shiny:value distPlot
#&gt; {chromote}   JS info   10:00:31.57 shinytest2; Shiny has been idle for 200ms
#&gt; {shinytest2} R  info   10:00:31.57 Shiny app started
#&gt; {shiny}      R  stderr ----------- Loading required package: shiny
#&gt; {shiny}      R  stderr ----------- Running application in test mode.
#&gt; {shiny}      R  stderr -----------
#&gt; {shiny}      R  stderr ----------- Listening on http://127.0.0.1:4679


# To capture all websocket traffic, set `options = list(shiny.trace = TRUE)`
app2 &lt;- AppDriver$new(
  system.file("examples/01_hello", package = "shiny"),
  options = list(shiny.trace = TRUE)
)

app2$get_logs()
## (All WebSocket messages have been replaced with `WEBSOCKET_MSG` in example below)
#&gt; {shinytest2} R  info      10:01:57.49 Start AppDriver initialization
#&gt; {shinytest2} R  info      10:01:57.50 Starting Shiny app
#&gt; {shinytest2} R  info      10:01:58.20 Creating new ChromoteSession
#&gt; {shinytest2} R  info      10:01:58.35 Navigating to Shiny app
#&gt; {shinytest2} R  info      10:01:58.47 Injecting shiny-tracer.js
#&gt; {chromote}   JS info      10:01:58.49 shinytest2; jQuery not found
#&gt; {chromote}   JS info      10:01:58.49 shinytest2; Loaded
#&gt; {shinytest2} R  info      10:01:58.50 Waiting for Shiny to become ready
#&gt; {chromote}   JS info      10:01:58.55 shinytest2; jQuery found
#&gt; {chromote}   JS info      10:01:58.55 shinytest2; Waiting for shiny session to connect
#&gt; {chromote}   JS websocket 10:01:58.64 send WEBSOCKET_MSG
#&gt; {chromote}   JS websocket 10:01:58.67 recv WEBSOCKET_MSG
#&gt; {chromote}   JS info      10:01:58.67 shinytest2; Connected
#&gt; {chromote}   JS websocket 10:01:58.71 recv WEBSOCKET_MSG
#&gt; {chromote}   JS websocket 10:01:58.72 recv WEBSOCKET_MSG
#&gt; {chromote}   JS info      10:01:58.72 shinytest2; shiny:busy
#&gt; {chromote}   JS websocket 10:01:58.73 recv WEBSOCKET_MSG
#&gt; {chromote}   JS websocket 10:01:58.73 recv WEBSOCKET_MSG
#&gt; {shinytest2} R  info      10:01:58.75 Waiting for Shiny to become idle for 200ms within 15000ms
#&gt; {chromote}   JS info      10:01:58.75 shinytest2; Waiting for Shiny to be stable
#&gt; {chromote}   JS websocket 10:01:58.81 recv WEBSOCKET_MSG
#&gt; {chromote}   JS websocket 10:01:58.81 recv WEBSOCKET_MSG
#&gt; {chromote}   JS info      10:01:58.81 shinytest2; shiny:idle
#&gt; {chromote}   JS websocket 10:01:58.82 recv WEBSOCKET_MSG
#&gt; {chromote}   JS info      10:01:58.82 shinytest2; shiny:value distPlot
#&gt; {chromote}   JS info      10:01:59.01 shinytest2; Shiny has been idle for 200ms
#&gt; {shinytest2} R  info      10:01:59.01 Shiny app started
#&gt; {shiny}      R  stderr    ----------- Loading required package: shiny
#&gt; {shiny}      R  stderr    ----------- Running application in test mode.
#&gt; {shiny}      R  stderr    -----------
#&gt; {shiny}      R  stderr    ----------- Listening on http://127.0.0.1:4560
#&gt; {shiny}      R  stderr    ----------- SEND {"config":{"workerId":"","sessionId"|truncated
#&gt; {shiny}      R  stderr    ----------- RECV {"method":"init","data":{"bins":30,|truncated
#&gt; {shiny}      R  stderr    ----------- SEND {"custom":{"showcase-src":{"srcref":|truncated
#&gt; {shiny}      R  stderr    ----------- SEND {"busy":"busy"}
#&gt; {shiny}      R  stderr    ----------- SEND {"custom":{"showcase-src":{"srcref":|truncated
#&gt; {shiny}      R  stderr    ----------- SEND {"recalculating":{"name":"distPlot",|truncated
#&gt; {shiny}      R  stderr    ----------- SEND {"recalculating":{"name":"distPlot",|truncated
#&gt; {shiny}      R  stderr    ----------- SEND {"busy":"idle"}
#&gt; {shiny}      R  stderr    ----------- SEND {"errors":{},"values":{"distPlot":|truncated

# The log that is returned is a `data.frame()`.
log &lt;- app2$get_logs()
tibble::glimpse(log)
#&gt; Rows: 43
#&gt; Columns: 5
#&gt; $ workerid  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#&gt; $ timestamp &lt;dttm&gt; 2022-09-19 10:01:57, 2022-09-19 10:01:57, 2022-09-19 10:01:58, 2022…
#&gt; $ location  &lt;chr&gt; "shinytest2", "shinytest2", "shinytest2", "shinytest2", "shinytest2"…
#&gt; $ level     &lt;chr&gt; "info", "info", "info", "info", "info", "info", "info", "info", "inf…
#&gt; $ message   &lt;chr&gt; "Start AppDriver initialization", "Starting Shiny app", "Creating ne…
#&gt; $ workerid  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#&gt; $ timestamp &lt;dttm&gt; 2022-03-16 11:09:57, 2022-03-16 11:09:57, 2022-03-16 11:09:…
#&gt; $ location  &lt;chr&gt; "shinytest2", "shinytest2", "shinytest2", "shinytest2", "shi…
#&gt; $ level     &lt;chr&gt; "info", "info", "info", "info", "info", "info", "info", "inf…
#&gt; $ message   &lt;chr&gt; "Start AppDriver initialization", "Starting Shiny app", "Cre…

# It may be filtered to find desired logs
subset(log, level == "websocket")
## (All WebSocket messages have been replaced with `WEBSOCKET_MSG` in example below)
#&gt; {chromote} JS websocket 10:01:58.64 send WEBSOCKET_MSG
#&gt; {chromote} JS websocket 10:01:58.67 recv WEBSOCKET_MSG
#&gt; {chromote} JS websocket 10:01:58.71 recv WEBSOCKET_MSG
#&gt; {chromote} JS websocket 10:01:58.72 recv WEBSOCKET_MSG
#&gt; {chromote} JS websocket 10:01:58.73 recv WEBSOCKET_MSG
#&gt; {chromote} JS websocket 10:01:58.73 recv WEBSOCKET_MSG
#&gt; {chromote} JS websocket 10:01:58.81 recv WEBSOCKET_MSG
#&gt; {chromote} JS websocket 10:01:58.81 recv WEBSOCKET_MSG
#&gt; {chromote} JS websocket 10:01:58.82 recv WEBSOCKET_MSG
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-log_message"></a><div class="section">
<h3 id="method-log-message-">Method <code>log_message()</code><a class="anchor" aria-label="anchor" href="#method-log-message-"></a></h3>
<p>Add a message to the <span class="pkg">shinytest2</span> log.</p><div class="section">
<h4 id="usage-30">Usage<a class="anchor" aria-label="anchor" href="#usage-30"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="fu">log_message</span><span class="op">(</span><span class="va">message</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-22">Arguments<a class="anchor" aria-label="anchor" href="#arguments-22"></a></h4>
<p></p><div class="arguments"><dl><dt><code>message</code></dt>
<dd><p>Single message to store in log</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="examples-30">Examples<a class="anchor" aria-label="anchor" href="#examples-30"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
app_path &lt;- system.file("examples/01_hello", package = "shiny")
app &lt;- AppDriver$new(app_path)

app$log_message("Setting bins to smaller value")
app$set_inputs(bins = 10)
app$get_logs()
}
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-AppDriver-stop"></a><div class="section">
<h3 id="method-stop-">Method <code><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop()</a></code><a class="anchor" aria-label="anchor" href="#method-stop-"></a></h3>
<p>Stop the Shiny application driver</p>
<p>This method stops all known processes:</p><ul><li><p>The Shiny application in the background R process,</p></li>
<li><p>the background R process hosting the Shiny application, and</p></li>
<li><p>the Chromote Session instance.</p></li>
</ul><p>To stop your shiny application and return a value from <code>$stop()</code>, see
<code><a href="https://rdrr.io/pkg/shiny/man/stopApp.html" class="external-link">shiny::stopApp()</a></code>. This is useful in testing to return context
information.</p>
<p>Typically, this can be paired with a button that when clicked will call
<code>shiny::stopApp(info)</code> to return <code>info</code> from the test app back to the
main R session.</p><div class="section">
<h4 id="usage-31">Usage<a class="anchor" aria-label="anchor" href="#usage-31"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">AppDriver</span><span class="op">$</span><span class="kw">stop</span><span class="op">(</span>signal_timeout <span class="op">=</span> <span class="fu">missing_arg</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-23">Arguments<a class="anchor" aria-label="anchor" href="#arguments-23"></a></h4>
<p></p><div class="arguments"><dl><dt><code>signal_timeout</code></dt>
<dd><p>Milliseconds to wait between sending a <code>SIGINT</code>,
<code>SIGTERM</code>, and <code>SIGKILL</code> to the Shiny process. Defaults to 500ms and does
not utilize the resolved value from <code>AppDriver$new(timeout=)</code>. However,
if <span class="pkg">covr</span> is currently executing, then the <code>timeout</code> is set to
20,000ms to allow for the coverage report to be generated.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-15">Returns<a class="anchor" aria-label="anchor" href="#returns-15"></a></h4>
<p>The result of the background process if the Shiny application has
already been terminated.</p>
</div>
<div class="section">
<h4 id="examples-31">Examples<a class="anchor" aria-label="anchor" href="#examples-31"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>\dontrun{
rlang::check_installed("reactlog")

library(shiny)
shiny_app &lt;- shinyApp(
  ui = fluidPage(
    actionButton("button", "Stop app and return Reactlog"),
    "Click count:", textOutput("count")
  ),
  server = function(input, output) {
    output$count &lt;- renderText({ input$button })
    observe({
      req(input$button)
      stopApp(shiny::reactlog())
    })
  }
)

app &lt;- AppDriver$new(
  shiny_app,
  # Enable reactlog in background R session
  options = list(shiny.reactlog = TRUE)
)

app$click("button")
rlog &lt;- app$stop()
str(head(rlog, 2))
#&gt; List of 2
#&gt; $ :List of 7
#&gt; ..$ action : chr "define"
#&gt; ..$ reactId: chr "r3"
#&gt; ..$ label  : chr "Theme Counter"
#&gt; ..$ type   : chr "reactiveVal"
#&gt; ..$ value  : chr " num 0"
#&gt; ..$ session: chr "bdc7417f2fc8c84fc05c9518e36fdc44"
#&gt; ..$ time   : num 1.65e+09
#&gt; $ :List of 7
#&gt; ..$ action : chr "define"
#&gt; ..$ reactId: chr "r4"
#&gt; ..$ label  : chr "output$count"
#&gt; .. ..- attr(*, "srcref")= int [1:6] 7 32 7 45 32 45
#&gt; .. ..- attr(*, "srcfile")= chr ""
#&gt; ..$ type   : chr "observer"
#&gt; ..$ value  : chr " NULL"
#&gt; ..$ session: chr "bdc7417f2fc8c84fc05c9518e36fdc44"
#&gt; ..$ time   : num 1.65e+09
}
</code></pre></div><p></p></div>
</div>


</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$new`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Create an AppDriver from the Shiny app in the current directory</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="fu">AppDriver</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create an AppDriver object from a different Shiny app directory</span></span></span>
<span class="r-in"><span><span class="va">example_app</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/01_hello"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="fu">AppDriver</span><span class="op">(</span><span class="va">example_app</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Expect consistent inital values</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">expect_values</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$view`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Open app in Chrome</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">view</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$click`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">app_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/07_widgets"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">app_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tmpfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">cars</span>, <span class="st">"cars.csv"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">upload_file</span><span class="op">(</span>file1 <span class="op">=</span> <span class="va">tmpfile</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">app</span><span class="op">$</span><span class="fu">get_text</span><span class="op">(</span><span class="st">"#view"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">set_inputs</span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"cars"</span>, obs <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">click</span><span class="op">(</span><span class="st">"update"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">app</span><span class="op">$</span><span class="fu">get_text</span><span class="op">(</span><span class="st">"#view"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$set_inputs`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">app_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/07_widgets"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">app_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">app</span><span class="op">$</span><span class="fu">get_text</span><span class="op">(</span><span class="st">"#view"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">set_inputs</span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"cars"</span>, obs <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">click</span><span class="op">(</span><span class="st">"update"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">app</span><span class="op">$</span><span class="fu">get_text</span><span class="op">(</span><span class="st">"#view"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$upload_file`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">app_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/09_upload"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">app_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Save example file</span></span></span>
<span class="r-in"><span><span class="va">tmpfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".csv"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">cars</span>, <span class="va">tmpfile</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Upload file to input named: file1</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">upload_file</span><span class="op">(</span>file1 <span class="op">=</span> <span class="va">tmpfile</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$expect_values`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">shiny_app</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h1</a></span><span class="op">(</span><span class="st">"Pythagorean theorem"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/numericInput.html" class="external-link">numericInput</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/numericInput.html" class="external-link">numericInput</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"B"</span>, <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html" class="external-link">verbatimTextOutput</a></span><span class="op">(</span><span class="st">"C"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">a_squared</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html" class="external-link">req</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">A</span><span class="op">)</span>; <span class="va">input</span><span class="op">$</span><span class="va">A</span> <span class="op">*</span> <span class="va">input</span><span class="op">$</span><span class="va">A</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">b_squared</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html" class="external-link">req</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">B</span><span class="op">)</span>; <span class="va">input</span><span class="op">$</span><span class="va">B</span> <span class="op">*</span> <span class="va">input</span><span class="op">$</span><span class="va">B</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">c_squared</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="fu">a_squared</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">b_squared</span><span class="op">(</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">c_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu">c_squared</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">output</span><span class="op">$</span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html" class="external-link">renderText</a></span><span class="op">(</span><span class="op">{</span> <span class="fu">c_value</span><span class="op">(</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/exportTestValues.html" class="external-link">exportTestValues</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      a_squared <span class="op">=</span> <span class="op">{</span> <span class="fu">a_squared</span><span class="op">(</span><span class="op">)</span> <span class="op">}</span>,</span></span>
<span class="r-in"><span>      b_squared <span class="op">=</span> <span class="op">{</span> <span class="fu">b_squared</span><span class="op">(</span><span class="op">)</span> <span class="op">}</span>,</span></span>
<span class="r-in"><span>      c_squared <span class="op">=</span> <span class="op">{</span> <span class="fu">c_squared</span><span class="op">(</span><span class="op">)</span> <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">shiny_app</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Snapshot all known values</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">expect_values</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Snapshot only `export` values</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">expect_values</span><span class="op">(</span>export <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Snapshot values `"A"` from `input` and `"C"` from `output`</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">expect_values</span><span class="op">(</span>input <span class="op">=</span> <span class="st">"A"</span>, output <span class="op">=</span> <span class="st">"C"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$get_value`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">app_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/04_mpg"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">app_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Retrieve a single value</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_value</span><span class="op">(</span>output <span class="op">=</span> <span class="st">"caption"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] "mpg ~ cyl"</span></span></span>
<span class="r-in"><span><span class="co"># Equivalent code using `$get_values()`</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_values</span><span class="op">(</span>output <span class="op">=</span> <span class="st">"caption"</span><span class="op">)</span><span class="op">$</span><span class="va">output</span><span class="op">$</span><span class="va">caption</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] "mpg ~ cyl"</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$get_values`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">shiny_app</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h1</a></span><span class="op">(</span><span class="st">"Pythagorean theorem"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/numericInput.html" class="external-link">numericInput</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/numericInput.html" class="external-link">numericInput</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"B"</span>, <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html" class="external-link">verbatimTextOutput</a></span><span class="op">(</span><span class="st">"C"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">a_squared</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html" class="external-link">req</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">A</span><span class="op">)</span>; <span class="va">input</span><span class="op">$</span><span class="va">A</span> <span class="op">*</span> <span class="va">input</span><span class="op">$</span><span class="va">A</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">b_squared</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html" class="external-link">req</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">B</span><span class="op">)</span>; <span class="va">input</span><span class="op">$</span><span class="va">B</span> <span class="op">*</span> <span class="va">input</span><span class="op">$</span><span class="va">B</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">c_squared</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="fu">a_squared</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">b_squared</span><span class="op">(</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">c_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu">c_squared</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">output</span><span class="op">$</span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html" class="external-link">renderText</a></span><span class="op">(</span><span class="op">{</span> <span class="fu">c_value</span><span class="op">(</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/exportTestValues.html" class="external-link">exportTestValues</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      a_squared <span class="op">=</span> <span class="op">{</span> <span class="fu">a_squared</span><span class="op">(</span><span class="op">)</span> <span class="op">}</span>,</span></span>
<span class="r-in"><span>      b_squared <span class="op">=</span> <span class="op">{</span> <span class="fu">b_squared</span><span class="op">(</span><span class="op">)</span> <span class="op">}</span>,</span></span>
<span class="r-in"><span>      c_squared <span class="op">=</span> <span class="op">{</span> <span class="fu">c_squared</span><span class="op">(</span><span class="op">)</span> <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">shiny_app</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Show all known values</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">app</span><span class="op">$</span><span class="fu">get_values</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; List of 3</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $ input :List of 2</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ A: int 3</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ B: int 4</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $ output:List of 1</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ C: chr "5"</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $ export:List of 3</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ a_squared: int 9</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ b_squared: int 16</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ c_squared: int 25</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get only `export` values</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">app</span><span class="op">$</span><span class="fu">get_values</span><span class="op">(</span>export <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; List of 1</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $ export:List of 3</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ a_squared: int 9</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ b_squared: int 16</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ c_squared: int 25</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get values `"A"` from `input` and `"C"` from `output`</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">app</span><span class="op">$</span><span class="fu">get_values</span><span class="op">(</span>input <span class="op">=</span> <span class="st">"A"</span>, output <span class="op">=</span> <span class="st">"C"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; List of 2</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $ input :List of 1</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ A: int 3</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $ output:List of 1</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ C: chr "5"</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$expect_download`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">app_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/10_download"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">app_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Save snapshot of rock.csv as 001.download</span></span></span>
<span class="r-in"><span><span class="co"># Save snapshot value of `rock.csv` to capture default file name</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">expect_download</span><span class="op">(</span><span class="st">"downloadData"</span>, compare <span class="op">=</span> <span class="fu">testthat</span><span class="fu">::</span><span class="va"><a href="https://testthat.r-lib.org/reference/expect_snapshot_file.html" class="external-link">compare_file_text</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$get_download`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">app_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/10_download"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">app_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get rock.csv as a tempfile</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_download</span><span class="op">(</span><span class="st">"downloadData"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] "/TEMP/PATH/rock.csv"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get rock.csv as a "./myfile.csv"</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_download</span><span class="op">(</span><span class="st">"downloadData"</span>, filename <span class="op">=</span> <span class="st">"./myfile.csv"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] "./myfile.csv"</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$expect_text`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">hello_app</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/01_hello"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">hello_app</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Make a snapshot of `"Hello Shiny!"`</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">expect_text</span><span class="op">(</span><span class="st">"h2"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$get_text`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">hello_app</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/01_hello"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">hello_app</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_text</span><span class="op">(</span><span class="st">"h2"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] "Hello Shiny!"</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$expect_html`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">app_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/04_mpg"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">app_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Save a snapshot of the `caption` output</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">expect_html</span><span class="op">(</span><span class="st">"#caption"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$get_html`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">app_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/03_reactivity"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">app_path</span>, check_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">set_inputs</span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Custom value!"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">app</span><span class="op">$</span><span class="fu">get_html</span><span class="op">(</span><span class="st">".shiny-input-container"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; &lt;div class="form-group shiny-input-container"&gt;</span></span></span>
<span class="r-in"><span><span class="co">#&gt;   &lt;label class="control-label" id="caption-label" for="caption"&gt;Caption:&lt;/label&gt;</span></span></span>
<span class="r-in"><span><span class="co">#&gt;   &lt;input id="caption" type="text" class="form-control shiny-bound-input" value="Data Summary"&gt;</span></span></span>
<span class="r-in"><span><span class="co">#&gt; &lt;/div&gt;</span></span></span>
<span class="r-in"><span><span class="co">## ^^ No update to the DOM of `caption`</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$expect_js`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">app_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/07_widgets"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">app_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Track how many clicks are given to `#update` button</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">run_js</span><span class="op">(</span><span class="st">"</span></span></span>
<span class="r-in"><span><span class="st">  window.test_counter = 0;</span></span></span>
<span class="r-in"><span><span class="st">  $('#update').click(() =&gt; window.test_counter++);</span></span></span>
<span class="r-in"><span><span class="st">"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">set_inputs</span><span class="op">(</span>obs <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Click the update button, incrementing the counter</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">click</span><span class="op">(</span><span class="st">"update"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Save a snapshot of number of clicks (1)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">expect_js</span><span class="op">(</span><span class="st">"window.test_counter;"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$get_js`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">shiny_app</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h1</a></span><span class="op">(</span><span class="st">"Empty App"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">shiny_app</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Execute JavaScript code in the app's browser</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_js</span><span class="op">(</span><span class="st">"1 + 1;"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] 2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Execute a JavaScript Promise. Return the resolved value.</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_js</span><span class="op">(</span><span class="st">"</span></span></span>
<span class="r-in"><span><span class="st">  new Promise((resolve) =&gt; {</span></span></span>
<span class="r-in"><span><span class="st">    setTimeout(() =&gt; resolve(1 + 1), 1000)</span></span></span>
<span class="r-in"><span><span class="st">  }).</span></span></span>
<span class="r-in"><span><span class="st">  then((value) =&gt; value + 1);</span></span></span>
<span class="r-in"><span><span class="st">"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] 3</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With escaped arguments</span></span></span>
<span class="r-in"><span><span class="va">loc_field</span> <span class="op">&lt;-</span> <span class="st">"hostname"</span></span></span>
<span class="r-in"><span><span class="va">js_txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"window.location["</span>, <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">loc_field</span>, auto_unbox <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"]"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_js</span><span class="op">(</span><span class="va">js_txt</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] "127.0.0.1"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With `glue::glue()`</span></span></span>
<span class="r-in"><span><span class="va">js_txt</span> <span class="op">&lt;-</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue_data</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">40</span>, y <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu">jsonlite</span><span class="fu">::</span><span class="va"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span>,</span></span>
<span class="r-in"><span>    auto_unbox <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  .open <span class="op">=</span> <span class="st">"&lt;"</span>, .close <span class="op">=</span> <span class="st">"&gt;"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"let answer = function(a, b) {\n"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"  return a + b;\n"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"};\n"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"answer(&lt;x&gt;, &lt;y&gt;);\n"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_js</span><span class="op">(</span><span class="va">js_txt</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] 42</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$run_js`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">shiny_app</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h1</a></span><span class="op">(</span><span class="st">"Empty App"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">shiny_app</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get JavaScript answer from the app's browser</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_js</span><span class="op">(</span><span class="st">"1 + 1"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] 2</span></span></span>
<span class="r-in"><span><span class="co"># Execute JavaScript code in the app's browser</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">run_js</span><span class="op">(</span><span class="st">"1 + 1"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># (Returns `app` invisibly)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With escaped arguments</span></span></span>
<span class="r-in"><span><span class="va">loc_field</span> <span class="op">&lt;-</span> <span class="st">"hostname"</span></span></span>
<span class="r-in"><span><span class="va">js_txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"window.location["</span>, <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">loc_field</span>, auto_unbox <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"]"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">run_js</span><span class="op">(</span><span class="va">js_txt</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_js</span><span class="op">(</span><span class="va">js_txt</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] "127.0.0.1"</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$expect_screenshot`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># These example lines should be performed in a `./tests/testthat`</span></span></span>
<span class="r-in"><span><span class="co"># test file so that snapshot files can be properly saved</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/01_hello"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">app_path</span>, variant <span class="op">=</span> <span class="fu"><a href="platform_variant.html">platform_variant</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Expect a full size screenshot to be pixel perfect</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">expect_screenshot</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Images are brittle when containing plots</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">expect_screenshot</span><span class="op">(</span>selector <span class="op">=</span> <span class="st">"#distPlot"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Test with more threshold in pixel value differences</span></span></span>
<span class="r-in"><span><span class="co"># Helps with rounded corners</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">expect_screenshot</span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Equivalent expectations</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">expect_screenshot</span><span class="op">(</span><span class="op">)</span> <span class="co"># default</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">expect_screenshot</span><span class="op">(</span>threshold <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">expect_screenshot</span><span class="op">(</span>compare <span class="op">=</span> <span class="fu">testthat</span><span class="fu">::</span><span class="va"><a href="https://testthat.r-lib.org/reference/expect_snapshot_file.html" class="external-link">compare_file_binary</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">expect_snapshot_file</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">app</span><span class="op">$</span><span class="fu">get_screenshot</span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  variant <span class="op">=</span> <span class="va">app</span><span class="op">$</span><span class="fu">get_variant</span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  compare <span class="op">=</span> <span class="fu">testthat</span><span class="fu">::</span><span class="va"><a href="https://testthat.r-lib.org/reference/expect_snapshot_file.html" class="external-link">compare_file_binary</a></span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Equivalent expectations</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">expect_screenshot</span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">3</span>, kernel_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">expect_screenshot</span><span class="op">(</span>compare <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">old</span>, <span class="va">new</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="compare_screenshot_threshold.html">compare_screenshot_threshold</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">old</span>, <span class="va">new</span>,</span></span>
<span class="r-in"><span>    threshold <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>    kernel_size <span class="op">=</span> <span class="fl">5</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">expect_screenshot_file</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">app</span><span class="op">$</span><span class="fu">get_screenshot</span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  variant <span class="op">=</span> <span class="va">app</span><span class="op">$</span><span class="fu">get_variant</span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  compare <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">old</span>, <span class="va">new</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="compare_screenshot_threshold.html">compare_screenshot_threshold</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="va">old</span>, <span class="va">new</span>,</span></span>
<span class="r-in"><span>      threshold <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>      kernel_size <span class="op">=</span> <span class="fl">5</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Take a screenshot of the entire scrollable area</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">expect_screenshot</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">expect_screenshot</span><span class="op">(</span>selector <span class="op">=</span> <span class="st">"scrollable_area"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Take a screenshot of the current viewport</span></span></span>
<span class="r-in"><span><span class="co"># Shrink the window to be smaller than the app</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">set_window_size</span><span class="op">(</span><span class="fl">400</span>, <span class="fl">500</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Scroll the viewport just a bit</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">run_js</span><span class="op">(</span><span class="st">"window.scroll(30, 70)"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Take screenshot of browser viewport</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">expect_screenshot</span><span class="op">(</span>selector <span class="op">=</span> <span class="st">"viewport"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$get_screenshot`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">app_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/01_hello"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">app_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Display in graphics device</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_screenshot</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Update bins then display `"disPlot"` in graphics device</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">set_inputs</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_screenshot</span><span class="op">(</span>selector <span class="op">=</span> <span class="st">"#distPlot"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Save screenshot to file and view it</span></span></span>
<span class="r-in"><span><span class="va">tmpfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".png"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_screenshot</span><span class="op">(</span><span class="va">tmpfile</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">showimage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/showimage/man/show_image.html" class="external-link">show_image</a></span><span class="op">(</span><span class="va">tmpfile</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$wait_for_idle`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">app_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/01_hello"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">app_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pre_value</span> <span class="op">&lt;-</span> <span class="va">app</span><span class="op">$</span><span class="fu">get_value</span><span class="op">(</span>output <span class="op">=</span> <span class="st">"distPlot"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Update bins value</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">set_inputs</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">10</span>, wait_ <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">middle_value</span> <span class="op">&lt;-</span> <span class="va">app</span><span class="op">$</span><span class="fu">get_value</span><span class="op">(</span>output <span class="op">=</span> <span class="st">"distPlot"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">wait_for_idle</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">post_value</span> <span class="op">&lt;-</span> <span class="va">app</span><span class="op">$</span><span class="fu">get_value</span><span class="op">(</span>output <span class="op">=</span> <span class="st">"distPlot"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># No guarantee that these values are different</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">pre_value</span>, <span class="va">middle_value</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Will not be equal</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">pre_value</span>, <span class="va">post_value</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---------------------</span></span></span>
<span class="r-in"><span><span class="co">## Change the screen size to trigger a plot update</span></span></span>
<span class="r-in"><span><span class="va">pre_value</span> <span class="op">&lt;-</span> <span class="va">app</span><span class="op">$</span><span class="fu">get_value</span><span class="op">(</span>output <span class="op">=</span> <span class="st">"distPlot"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">set_window_size</span><span class="op">(</span>height <span class="op">=</span> <span class="fl">1080</span>, width <span class="op">=</span> <span class="fl">1920</span>, wait <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">middle_value</span> <span class="op">&lt;-</span> <span class="va">app</span><span class="op">$</span><span class="fu">get_value</span><span class="op">(</span>output <span class="op">=</span> <span class="st">"distPlot"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">wait_for_idle</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">post_value</span> <span class="op">&lt;-</span> <span class="va">app</span><span class="op">$</span><span class="fu">get_value</span><span class="op">(</span>output <span class="op">=</span> <span class="st">"distPlot"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># No guarantee that these values are different</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">pre_value</span>, <span class="va">middle_value</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Will not be equal</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">pre_value</span>, <span class="va">post_value</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$wait_for_value`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">shiny_app</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h1</a></span><span class="op">(</span><span class="st">"Dynamic output"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html" class="external-link">actionButton</a></span><span class="op">(</span><span class="st">"display"</span>, <span class="st">"Display UI"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html" class="external-link">uiOutput</a></span><span class="op">(</span><span class="st">"dym1"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">output</span><span class="op">$</span><span class="va">dym1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html" class="external-link">renderUI</a></span><span class="op">(</span><span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html" class="external-link">req</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">display</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># Artificial calculations</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"slider1"</span>, <span class="st">"Slider #1"</span>, <span class="fl">0</span>, <span class="fl">100</span>, <span class="fl">25</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html" class="external-link">uiOutput</a></span><span class="op">(</span><span class="st">"dym2"</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">output</span><span class="op">$</span><span class="va">dym2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html" class="external-link">renderUI</a></span><span class="op">(</span><span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># Artificial calculations</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span><span class="st">"slider2"</span>, <span class="st">"Slider #2"</span>, <span class="fl">0</span>, <span class="fl">100</span>, <span class="fl">50</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        <span class="st">"Total:"</span>, <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html" class="external-link">verbatimTextOutput</a></span><span class="op">(</span><span class="st">"total"</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">output</span><span class="op">$</span><span class="va">total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html" class="external-link">renderText</a></span><span class="op">(</span><span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html" class="external-link">req</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">slider1</span>, <span class="va">input</span><span class="op">$</span><span class="va">slider2</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="va">input</span><span class="op">$</span><span class="va">slider1</span> <span class="op">+</span> <span class="va">input</span><span class="op">$</span><span class="va">slider2</span></span></span>
<span class="r-in"><span>    <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">shiny_app</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create UI / output values</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">click</span><span class="op">(</span><span class="st">"display"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Wait for total to be calculated (or have a non-NULL value)</span></span></span>
<span class="r-in"><span><span class="va">new_total_value</span> <span class="op">&lt;-</span> <span class="va">app</span><span class="op">$</span><span class="fu">wait_for_value</span><span class="op">(</span>output <span class="op">=</span> <span class="st">"total"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] "75"</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_value</span><span class="op">(</span>output <span class="op">=</span> <span class="st">"total"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] "75"</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$wait_for_js`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">shiny_app</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">h1</a></span><span class="op">(</span><span class="st">"Empty App"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">shiny_app</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Contrived example:</span></span></span>
<span class="r-in"><span><span class="co"># Wait until `Date.now()` returns a number that ends in a 5. (0 - 10 seconds)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">app</span><span class="op">$</span><span class="fu">wait_for_js</span><span class="op">(</span><span class="st">"Math.floor((Date.now() / 1000) % 10) == 5;"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## A second example where we run the contents of a JavaScript file</span></span></span>
<span class="r-in"><span><span class="co">## and use the result to wait for a condition</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">run_js</span><span class="op">(</span>file <span class="op">=</span> <span class="st">"complicated_file.js"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">wait_for_js</span><span class="op">(</span><span class="st">"complicated_condition();"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$expect_unique_names`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">shiny_app</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  ui <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="co"># Duplicate input IDs: `"text"`</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textInput.html" class="external-link">textInput</a></span><span class="op">(</span><span class="st">"text"</span>, <span class="st">"Text 1"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textInput.html" class="external-link">textInput</a></span><span class="op">(</span><span class="st">"text"</span>, <span class="st">"Text 2"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  server <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="co"># empty</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Initial checking for unique names (default behavior)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">shiny_app</span>, check_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; Warning:</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ! Shiny inputs should have unique HTML id values.</span></span></span>
<span class="r-in"><span><span class="co">#&gt; i The following HTML id values are not unique:</span></span></span>
<span class="r-in"><span><span class="co">#&gt; • text</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="kw">stop</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Manually assert that all names are unique</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">shiny_app</span>, check_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">expect_unique_names</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; Error: `app_check_unique_names(self, private)` threw an unexpected warning.</span></span></span>
<span class="r-in"><span><span class="co">#&gt; Message: ! Shiny inputs should have unique HTML id values.</span></span></span>
<span class="r-in"><span><span class="co">#&gt; i The following HTML id values are not unique:</span></span></span>
<span class="r-in"><span><span class="co">#&gt;   • text</span></span></span>
<span class="r-in"><span><span class="co">#&gt; Class:   rlang_warning/warning/condition</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="kw">stop</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$get_dir`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">app_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/01_hello"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">app_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">app</span><span class="op">$</span><span class="fu">get_dir</span><span class="op">(</span><span class="op">)</span>, <span class="va">app_path</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] TRUE</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$get_url`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">app_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/01_hello"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">app_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/browseURL.html" class="external-link">browseURL</a></span><span class="op">(</span><span class="va">app</span><span class="op">$</span><span class="fu">get_url</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$get_window_size`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">app_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/01_hello"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">app_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_window_size</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $width</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] 992</span></span></span>
<span class="r-in"><span><span class="co">#&gt;</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $height</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] 1323</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$set_window_size`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">app_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/01_hello"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Set init window size</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">app_path</span>, height <span class="op">=</span> <span class="fl">1400</span>, width <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_window_size</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $width</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] 1000</span></span></span>
<span class="r-in"><span><span class="co">#&gt;</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $height</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] 1400</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Manually set the window size</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">set_window_size</span><span class="op">(</span>height <span class="op">=</span> <span class="fl">1080</span>, width <span class="op">=</span> <span class="fl">1920</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_window_size</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $width</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] 1920</span></span></span>
<span class="r-in"><span><span class="co">#&gt;</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $height</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] 1080</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$get_chromote_session`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">app_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/01_hello"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">app_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">app</span><span class="op">$</span><span class="fu">get_chromote_session</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">b</span><span class="op">$</span><span class="va">Runtime</span><span class="op">$</span><span class="fu">evaluate</span><span class="op">(</span><span class="st">"1 + 1"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $result</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $result$type</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] "number"</span></span></span>
<span class="r-in"><span><span class="co">#&gt;</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $result$value</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] 2</span></span></span>
<span class="r-in"><span><span class="co">#&gt;</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $result$description</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] "2"</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$get_variant`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">app_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/01_hello"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">app_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_variant</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; NULL</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">app_path</span>, variant <span class="op">=</span> <span class="fu"><a href="platform_variant.html">platform_variant</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_variant</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; [1] "mac-4.1"</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$get_logs`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">app1</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/01_hello"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app1</span><span class="op">$</span><span class="fu">get_logs</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shinytest2} R  info   10:00:28.86 Start AppDriver initialization</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shinytest2} R  info   10:00:28.86 Starting Shiny app</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shinytest2} R  info   10:00:29.76 Creating new ChromoteSession</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shinytest2} R  info   10:00:30.56 Navigating to Shiny app</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shinytest2} R  info   10:00:30.70 Injecting shiny-tracer.js</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS info   10:00:30.75 shinytest2; jQuery found</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS info   10:00:30.77 shinytest2; Waiting for shiny session to connect</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS info   10:00:30.77 shinytest2; Loaded</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shinytest2} R  info   10:00:30.77 Waiting for Shiny to become ready</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS info   10:00:30.90 shinytest2; Connected</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS info   10:00:30.95 shinytest2; shiny:busy</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shinytest2} R  info   10:00:30.98 Waiting for Shiny to become idle for 200ms within 15000ms</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS info   10:00:30.98 shinytest2; Waiting for Shiny to be stable</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS info   10:00:31.37 shinytest2; shiny:idle</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS info   10:00:31.38 shinytest2; shiny:value distPlot</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS info   10:00:31.57 shinytest2; Shiny has been idle for 200ms</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shinytest2} R  info   10:00:31.57 Shiny app started</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shiny}      R  stderr ----------- Loading required package: shiny</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shiny}      R  stderr ----------- Running application in test mode.</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shiny}      R  stderr -----------</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shiny}      R  stderr ----------- Listening on http://127.0.0.1:4679</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># To capture all websocket traffic, set `options = list(shiny.trace = TRUE)`</span></span></span>
<span class="r-in"><span><span class="va">app2</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/01_hello"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shiny.trace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app2</span><span class="op">$</span><span class="fu">get_logs</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## (All WebSocket messages have been replaced with `WEBSOCKET_MSG` in example below)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shinytest2} R  info      10:01:57.49 Start AppDriver initialization</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shinytest2} R  info      10:01:57.50 Starting Shiny app</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shinytest2} R  info      10:01:58.20 Creating new ChromoteSession</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shinytest2} R  info      10:01:58.35 Navigating to Shiny app</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shinytest2} R  info      10:01:58.47 Injecting shiny-tracer.js</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS info      10:01:58.49 shinytest2; jQuery not found</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS info      10:01:58.49 shinytest2; Loaded</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shinytest2} R  info      10:01:58.50 Waiting for Shiny to become ready</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS info      10:01:58.55 shinytest2; jQuery found</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS info      10:01:58.55 shinytest2; Waiting for shiny session to connect</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS websocket 10:01:58.64 send WEBSOCKET_MSG</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS websocket 10:01:58.67 recv WEBSOCKET_MSG</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS info      10:01:58.67 shinytest2; Connected</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS websocket 10:01:58.71 recv WEBSOCKET_MSG</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS websocket 10:01:58.72 recv WEBSOCKET_MSG</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS info      10:01:58.72 shinytest2; shiny:busy</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS websocket 10:01:58.73 recv WEBSOCKET_MSG</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS websocket 10:01:58.73 recv WEBSOCKET_MSG</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shinytest2} R  info      10:01:58.75 Waiting for Shiny to become idle for 200ms within 15000ms</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS info      10:01:58.75 shinytest2; Waiting for Shiny to be stable</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS websocket 10:01:58.81 recv WEBSOCKET_MSG</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS websocket 10:01:58.81 recv WEBSOCKET_MSG</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS info      10:01:58.81 shinytest2; shiny:idle</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS websocket 10:01:58.82 recv WEBSOCKET_MSG</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS info      10:01:58.82 shinytest2; shiny:value distPlot</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote}   JS info      10:01:59.01 shinytest2; Shiny has been idle for 200ms</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shinytest2} R  info      10:01:59.01 Shiny app started</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shiny}      R  stderr    ----------- Loading required package: shiny</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shiny}      R  stderr    ----------- Running application in test mode.</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shiny}      R  stderr    -----------</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shiny}      R  stderr    ----------- Listening on http://127.0.0.1:4560</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shiny}      R  stderr    ----------- SEND {"config":{"workerId":"","sessionId"|truncated</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shiny}      R  stderr    ----------- RECV {"method":"init","data":{"bins":30,|truncated</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shiny}      R  stderr    ----------- SEND {"custom":{"showcase-src":{"srcref":|truncated</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shiny}      R  stderr    ----------- SEND {"busy":"busy"}</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shiny}      R  stderr    ----------- SEND {"custom":{"showcase-src":{"srcref":|truncated</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shiny}      R  stderr    ----------- SEND {"recalculating":{"name":"distPlot",|truncated</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shiny}      R  stderr    ----------- SEND {"recalculating":{"name":"distPlot",|truncated</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shiny}      R  stderr    ----------- SEND {"busy":"idle"}</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {shiny}      R  stderr    ----------- SEND {"errors":{},"values":{"distPlot":|truncated</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The log that is returned is a `data.frame()`.</span></span></span>
<span class="r-in"><span><span class="va">log</span> <span class="op">&lt;-</span> <span class="va">app2</span><span class="op">$</span><span class="fu">get_logs</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">log</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; Rows: 43</span></span></span>
<span class="r-in"><span><span class="co">#&gt; Columns: 5</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $ workerid  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $ timestamp &lt;dttm&gt; 2022-09-19 10:01:57, 2022-09-19 10:01:57, 2022-09-19 10:01:58, 2022…</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $ location  &lt;chr&gt; "shinytest2", "shinytest2", "shinytest2", "shinytest2", "shinytest2"…</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $ level     &lt;chr&gt; "info", "info", "info", "info", "info", "info", "info", "info", "inf…</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $ message   &lt;chr&gt; "Start AppDriver initialization", "Starting Shiny app", "Creating ne…</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $ workerid  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $ timestamp &lt;dttm&gt; 2022-03-16 11:09:57, 2022-03-16 11:09:57, 2022-03-16 11:09:…</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $ location  &lt;chr&gt; "shinytest2", "shinytest2", "shinytest2", "shinytest2", "shi…</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $ level     &lt;chr&gt; "info", "info", "info", "info", "info", "info", "info", "inf…</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $ message   &lt;chr&gt; "Start AppDriver initialization", "Starting Shiny app", "Cre…</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># It may be filtered to find desired logs</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">log</span>, <span class="va">level</span> <span class="op">==</span> <span class="st">"websocket"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## (All WebSocket messages have been replaced with `WEBSOCKET_MSG` in example below)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote} JS websocket 10:01:58.64 send WEBSOCKET_MSG</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote} JS websocket 10:01:58.67 recv WEBSOCKET_MSG</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote} JS websocket 10:01:58.71 recv WEBSOCKET_MSG</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote} JS websocket 10:01:58.72 recv WEBSOCKET_MSG</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote} JS websocket 10:01:58.73 recv WEBSOCKET_MSG</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote} JS websocket 10:01:58.73 recv WEBSOCKET_MSG</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote} JS websocket 10:01:58.81 recv WEBSOCKET_MSG</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote} JS websocket 10:01:58.81 recv WEBSOCKET_MSG</span></span></span>
<span class="r-in"><span><span class="co">#&gt; {chromote} JS websocket 10:01:58.82 recv WEBSOCKET_MSG</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$log_message`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">app_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples/01_hello"</span>, package <span class="op">=</span> <span class="st">"shiny"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">app_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">log_message</span><span class="op">(</span><span class="st">"Setting bins to smaller value"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">set_inputs</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">get_logs</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">## Method `AppDriver$stop`</span></span></span>
<span class="r-in"><span><span class="co">## ------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/is_installed.html" class="external-link">check_installed</a></span><span class="op">(</span><span class="st">"reactlog"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">shiny_app</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  ui <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html" class="external-link">actionButton</a></span><span class="op">(</span><span class="st">"button"</span>, <span class="st">"Stop app and return Reactlog"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="st">"Click count:"</span>, <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textOutput.html" class="external-link">textOutput</a></span><span class="op">(</span><span class="st">"count"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  server <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">output</span><span class="op">$</span><span class="va">count</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPrint.html" class="external-link">renderText</a></span><span class="op">(</span><span class="op">{</span> <span class="va">input</span><span class="op">$</span><span class="va">button</span> <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observe.html" class="external-link">observe</a></span><span class="op">(</span><span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html" class="external-link">req</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">button</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/stopApp.html" class="external-link">stopApp</a></span><span class="op">(</span><span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactlog.html" class="external-link">reactlog</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app</span> <span class="op">&lt;-</span> <span class="va">AppDriver</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">shiny_app</span>,</span></span>
<span class="r-in"><span>  <span class="co"># Enable reactlog in background R session</span></span></span>
<span class="r-in"><span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shiny.reactlog <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">app</span><span class="op">$</span><span class="fu">click</span><span class="op">(</span><span class="st">"button"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rlog</span> <span class="op">&lt;-</span> <span class="va">app</span><span class="op">$</span><span class="kw">stop</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rlog</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#&gt; List of 2</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $ :List of 7</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ action : chr "define"</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ reactId: chr "r3"</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ label  : chr "Theme Counter"</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ type   : chr "reactiveVal"</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ value  : chr " num 0"</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ session: chr "bdc7417f2fc8c84fc05c9518e36fdc44"</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ time   : num 1.65e+09</span></span></span>
<span class="r-in"><span><span class="co">#&gt; $ :List of 7</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ action : chr "define"</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ reactId: chr "r4"</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ label  : chr "output$count"</span></span></span>
<span class="r-in"><span><span class="co">#&gt; .. ..- attr(*, "srcref")= int [1:6] 7 32 7 45 32 45</span></span></span>
<span class="r-in"><span><span class="co">#&gt; .. ..- attr(*, "srcfile")= chr ""</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ type   : chr "observer"</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ value  : chr " NULL"</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ session: chr "bdc7417f2fc8c84fc05c9518e36fdc44"</span></span></span>
<span class="r-in"><span><span class="co">#&gt; ..$ time   : num 1.65e+09</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="http://schloerke.com" class="external-link">Barret Schloerke</a>, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer></body></html>

